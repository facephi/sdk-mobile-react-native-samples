<?xml version="1.0" encoding="UTF-8"?>
<selphid-widget-conf version="1.0">

    <DocumentID id="ES" iso="ESP">
        <Version id="IMESP" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="elements" separation="0.05" space_separation="0.1">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="t_res" content="TARJETA@DE@RESIDENCIA@E@@@@@@@@" threshold="0.2"/>
                    <findLineContent dst="p_res" content="PERMISO@DE@RESIDENCIA@E@@@@@@@@" threshold="0.2"/>
                    <rejectIfNotValid2 src="t_res" src2="p_res" reason="DocumentNotExpected"/>

                    <findLineMatch dst="docNumber"
                        regex="([A-Za-z])-?([0-9oOlBASsG]{7})-?([A-Za-z])$"
                        value="([U]$1)([N]$2)([U]$3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineContent dst="name" content="APELLIDOS@Nombres@SURNAMES@Forenames" threshold="0.2"/>
                    <findLineContent dst="snfn" content="SEXO@SEX@NACIONALIDAD@NATIONALITY@FECHA@NAC@BIRTH@DATE" threshold="0.2"/>
                    <findLineContent dst="gener" content="SEXO@SEX" threshold="0.2"/>
                    <findLineContent dst="nacio" content="NACIONALIDAD@NATIONALITY" threshold="0.2"/>
                    <findLineContent dst="permi" content="TIPO@DE@PERMISO@TYPE@OF@PERMIT" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="permi" content="TIPO@DE@PERMISO@TYPE@OF@PERMIT@VALIDEZ@TARJETA@CARD@EXPIRY" threshold="0.2" overwrite="false"/>

                    <assignIfValid dst="lastName" src="name" offset="+1" overwrite="false"/>
                    <assignIfValid dst="firstName" src="name" offset="+2" overwrite="false"/>
                    <jumpIfNotValid src="firstName" dst="NOT_VALID_FN"/>
                        <rejectIfNotValid src="lastName"/>
                        <rejectIfNotValid src="firstName"/>
                        <assignIfValid dst="fullname" src="firstName" overwrite="false"/>
                        <concatenateIfValid dst="fullname" src="lastName" prefix=" " suffix=""/>
                        <assignField src="lastName" field="LastName"/>
                        <assignField src="firstName" field="FirstName"/>
                        <jump dst="VALID_FN"/>
                    <label src="NOT_VALID_FN"/>
                        <rejectIfNotValid src="lastName"/>
                        <assignIfValid dst="fullname" src="lastName" overwrite="false"/>
                    <label src="VALID_FN"/>

                    <assignField src="fullname" field="FullName"/>

                    <assignIfValid dst="genero" src="gener" offset="+1" overwrite="false"/>

                    <assignIfValid dst="nacionalidad" src="nacio" offset="+1" overwrite="false"/>

                    <assignIfValid dst="permiso" src="permi" offset="+1" overwrite="false"/>
                    <assignField src="permiso" field="TypeOfPermit"/>

                    <findLineMatch dst="dob"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="dob"/>
                    <assignField src="dob" field="DateOfBirth"/>

                    <findLineMatch dst="doe"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doe"/>
                    <assignField src="doe" field="DateOfExpiry"/>

                    <!-- We read dummy values for blocking purposes -->
                    <findLineMatch dst="dummy" regex="^(ESP)$" value="($1)"/>
                    <findLineMatch dst="dummy" regex="^(NIE)$" value="($1)"/>

                    <!-- We try to read gender again -->
                    <findLineMatch dst="genero" regex="^(M|F) [A-Z]{3}$" value="($1)" overwrite="false"/>
                    <findLineMatch dst="genero" regex="^(M|F)$" value="($1)" overwrite="false"/>
                    <assignField src="genero" field="Gender"/>

                    <!-- We try to read nationality again -->
                    <findLineMatch dst="nacionalidad" regex="^(?:M|F) ([A-Z]{3})$" value="($1)" overwrite="false"/>
                    <findLineMatch dst="nacionalidad" regex="^([A-Z]{3})$" value="($1)" overwrite="false"/>
                    <rejectIfNotValid src="nacionalidad"/>
                    <assignField src="nacionalidad" field="Nationality"/>

                    <!-- Support Number (IDCardNumber) -->
                    <matchIfValid dst="idcard" src="t_res" regex="E([0-9]{8})" value="E([N]$1)" overwrite="false"/>;
                    <matchIfValid dst="idcard" src="p_res" regex="E([0-9]{8})" value="E([N]$1)" overwrite="false"/>;
                    <findLineMatch dst="idcard" regex="^E([0-9]{8})$" value="E([N]$1)" overwrite="false"/>
                    <rejectIfNotValid src="idcard"/>
                    <assignField src="idcard" field="IDCardNumber"/>

                </ML>
            </Front>

            <Back>
                <ML cols="1" split_by="elements" separation="0.1" space_separation="0.1">

                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine3" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>

                    <matchIfValid src="mrzLine1" dst="mrzId" overwrite="false"
                        regex="^([Il1][DO0])"
                        value="([U]$1)"
                    />
                    <rejectIfValid src="mrzId" reason="DocumentNotExpected"/>

                    <findLineContent dst="res0" content="OBSERVACIONES@REMARKS" threshold="0.3"/>

                    <findLineMatch dst="doi"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <assignField src="doi" field="DateOfIssue"/>

                    <findLineContent dst="pob" content="LUGAR@DE@NACIMIENTO@PLACE@OF@BIRTH" threshold="0.2"/>
                    <findLineContent dst="domicilio" content="DOMICILIO@ADDRESS" threshold="3"/>

                    <rejectIfNotValid3 src="res0" src2="pob" src3="domicilio" reason="DocumentNotExpected"/>

                    <assignIfValid dst="placeOfBirth" src="pob" offset="+1" overwrite="false"/>
                    <assignField src="placeOfBirth" field="PlaceOfBirth"/>
                    
                    <assignIfValid dst="address" src="domicilio" offset="+1" overwrite="false"/>
                    <assignIfValid dst="address2" src="domicilio" offset="+2" overwrite="false"/>
                    <assignIfValid dst="address3" src="domicilio" offset="+3" overwrite="false"/>
                    <assignIfValid dst="address4" src="domicilio" offset="+4" overwrite="false"/>
                    
                    <jumpIfValid src="address4" dst="ADDRESS_4_LINES"/>
                        <concatenateIfValid dst="address" src="address2" prefix=" - " suffix=""/>
                        <concatenateIfValid dst="address" src="address3" prefix=" - " suffix=""/>
                        <assignIfValid dst="localidad" src="address2" overwrite="false"/>
                        <assignIfValid dst="provincia" src="address3" overwrite="false"/>
                        <jump dst="ADDRESS_3_LINES"/>
                    <label src="ADDRESS_4_LINES"/>
                        <concatenateIfValid dst="address" src="address2" prefix=" " suffix=""/>
                        <concatenateIfValid dst="address" src="address3" prefix=" - " suffix=""/>
                        <concatenateIfValid dst="address" src="address4" prefix=" - " suffix=""/>
                        <assignIfValid dst="localidad" src="address3" overwrite="false"/>
                        <assignIfValid dst="provincia" src="address4" overwrite="false"/>
                    <label src="ADDRESS_3_LINES"/>

                    <assignField src="address" field="Address"/>

                    <assignField src="localidad" field="Locality"/>
                    <assignField src="provincia" field="Province"/>

                </ML>

                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2" regex="IM"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="ESP"/>
                    <field id="IDCardNumber"    line="1" starts="6" count="9"/>
                    <field id="DocumentNumber"  line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
            </Back>
        </Version>

        <Version id="IRESP" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="1" split_by="elements" separation="0.05" space_separation="0.1">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="p_res" content="PERMISO@DE@RESIDENCIA" threshold="0.2"/>
                    <rejectIfNotValid src="p_res" reason="DocumentNotExpected"/>

                    <findLineMatch dst="docNumber"
                        regex="([A-Za-z])-?([0-9oOlBASsG]{7})-?([A-Za-z])$"
                        value="([U]$1)([N]$2)([U]$3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineMatch dst="doe"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doe"/>
                    <assignField src="doe" field="DateOfExpiry"/>

                    <findLineMatch dst="doi"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doi"/>
                    <assignField src="doi" field="DateOfIssue"/>

                    <findLineMatch dst="fullname"
                        regex="([Nn][Oo0D][MnNnH][Bb8][R8][Ee3]) ?(.+)"
                        value="([U]$2)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="fullname"/>
                    <assignField src="fullname" field="FullName"/>

                    <findLineContent dst="plc" content="LUGAR@Y@FECHA@DE@EMISIÓN" threshold="0.2"/>
                    <findLineContent dst="permi" content="TIPO@DE@PERMISO@TYPE@OF@PERMIT" threshold="0.2"/>
                    <findLineContent dst="domi" content="OBSERVACIONES@DOMICILIO" threshold="0.2"/>
                    <findLineContent dst="loca" content="LOCALIDAD" threshold="0.2"/>
                    <findLineContent dst="prov" content="PROVINCIA" threshold="0.2"/>

                    <assignIfValid dst="place" src="plc" offset="+1" overwrite="false"/>
                    <assignField src="place" field="PlaceOfEmission"/>

                    <assignIfValid dst="permiso" src="permi" offset="+1" overwrite="false"/>
                    <assignField src="permiso" field="TypeOfPermit"/>

                    <assignIfValid dst="localidad" src="loca" offset="+1" overwrite="false"/>
                    <assignField src="localidad" field="Locality"/>

                    <assignIfValid dst="provincia" src="prov" offset="+1" overwrite="false"/>
                    <assignField src="provincia" field="Province"/>

                    <assignIfValid dst="domicilio" src="domi" offset="+1" overwrite="false"/>
                    <assignIfValid dst="domicilio2" src="domi" offset="+2" overwrite="false"/>
                    <concatenateIfValid dst="domicilio" src="domicilio2" prefix=" " suffix=""/>
                    <concatenateIfValid dst="domicilio" src="localidad" prefix=" - " suffix=""/>
                    <concatenateIfValid dst="domicilio" src="provincia" prefix=" - " suffix=""/>
                    <assignField src="domicilio" field="Address"/>

                    <!-- Support Number (IDCardNumber) -->
                    <matchIfValid dst="idcard" src="p_res" regex="E([0-9]{8})" value="E([N]$1)" overwrite="false"/>;
                    <findLineMatch dst="idcard" regex="^E([0-9]{8})$" value="E([N]$1)" overwrite="false"/>
                    <rejectIfNotValid src="idcard"/>
                    <assignField src="idcard" field="IDCardNumber"/>

                </ML>
            </Front>

            <Back>
                <ML cols="3" split_by="elements" separation="0.05" space_separation="0.1">
                    
                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine3" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>

                    <matchIfValid src="mrzLine1" dst="mrzId" overwrite="false"
                        regex="^([Il1][DO0])"
                        value="([U]$1)"
                    />
                    <rejectIfValid src="mrzId" reason="DocumentNotExpected"/>

                    <findLineContent dst="res0" content="FECHA@Y@LUGAR@DE@NACIMIENTO" threshold="0.4"/>

                    <findLineMatch dst="dob"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="dob"/>
                    <assignField src="dob" field="DateOfBirth"/>

                    <assignIfValid dst="place" src="plc" offset="+1" overwrite="false"/>
                    <assignField src="place" field="PlaceOfBirth"/>

                    <findLineContent dst="generoh" content="V@M" threshold="1"/>
                    <assignIfContent src="generoh" dst="genero" value="M"
                        op="exists"
                        overwrite="false"
                    />
                    <findLineContent dst="generom" content="M@F" threshold="1"/>
                    <assignIfContent src="generom" dst="genero" value="F"
                        op="exists"
                        overwrite="false"
                    />
                    <assignField src="genero" field="Gender"/>

                    <findLineContent dst="nacio" content="NACIONALIDAD" threshold="0.2"/>
                    <assignIfValid dst="nacionalidad" src="nacio" offset="+1" overwrite="false"/>

                    <findLineContent dst="obser" content="OBSERVACIONES@ASPECTOS@LABORALES@O@MOTIVO@DE@CONCESIÓN" threshold="0.4"/>
                    <assignIfValid dst="observaciones" src="obser" offset="+1" overwrite="false"/>

                    <rejectIfNotValid3 src="res0" src2="nacio" src3="obser" reason="DocumentNotExpected"/>

                    <assignField src="nacionalidad" field="Nationality"/>
                    <assignField src="observaciones" field="Remarks"/>
                </ML>

                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2" regex="IR"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="ESP"/>
                    <field id="IDCardNumber"    line="1" starts="6" count="9"/>
                    <field id="DocumentNumber"  line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
            </Back>
        </Version>

        <Version id="IXESP" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="3" split_by="elements" separation="0.05" space_separation="0.1">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="res1" content="RÉGIMEN@COMUNITARIO" threshold="0.2"/>
                    <findLineContent dst="res2" content="ESTUDIANTE" threshold="0.2"/>
                    <rejectIfNotValid2 src="res1" src2="res2" reason="DocumentNotExpected"/>

                    <findLineMatch dst="docNumber"
                        regex="([A-Za-z])-?([0-9oOlBASsG]{7})-?([A-Za-z])$"
                        value="([U]$1)([N]$2)([U]$3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineContent dst="name" content="NOMBRE" threshold="0.2"/>
                    <rejectIfNotValid src="name"/>

                    <findLineContent dst="naci" content="NACIONALIDAD" threshold="0.2"/>
                    <findLineContent dst="domicilio" content="DOMICILIO" threshold="3"/>
                    <rejectIfNotValid2 src="naci" src2="domicilio"/>

                    <assignIfValid dst="fullname" src="name" offset="+1" overwrite="false"/>
                    <assignIfValid dst="fullname2" src="name" offset="+2" overwrite="false"/>
                    <concatenateIfValid dst="fullname" src="fullname2" prefix=" " suffix=""/>
                    <assignField src="fullname" field="FullName"/>

                    <assignIfValid dst="nacionalidad" src="naci" offset="+1" overwrite="false"/>
                    <assignField src="nacionalidad" field="Nationality"/>

                    <findLineMatch src="loca" dst="localidad"
                        regex="^[LU][Oo0][Cc][A4][LUI][\.|,]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <assignField src="localidad" field="Locality"/>

                    <findLineMatch src="prov" dst="provincia"
                        regex="^[Pp][R8][Oo0][VU][\.|,]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <assignField src="provincia" field="Province"/>
                    
                    <findLineMatch dst="domicilio" src="domicilioStr"
                        regex="([DOo0][Oo0D][MnNnH][Il1]?[CcOo0][Il1]?[LUu][Il1]?[Oo0D]) ?(.+)"
                        value="([U]$2)"
                        overwrite="false"
                    />
                    <assignIfValid dst="domicilio2" src="domicilioStr" offset="+1"/>

                    <concatenateIfValid dst="domicilio" src="domicilio2" prefix=" " suffix=""/>
                    <concatenateIfValid dst="domicilio" src="localidad" prefix=" - " suffix=""/>
                    <concatenateIfValid dst="domicilio" src="provincia" prefix=" - " suffix=""/>
                    <assignField src="domicilio" field="Address"/>

                    <findLineMatch dst="doe"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doe"/>
                    <assignField src="doe" field="DateOfExpiry"/>

                    <findLineMatch dst="dob"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="dob"/>
                    <assignField src="dob" field="DateOfBirth"/>

                    <findLineContent dst="generoh" content="SEXO@V@M" threshold="1"/>
                    <assignIfContent src="generoh" dst="genero" value="M"
                        op="exists"
                        overwrite="false"
                    />
                    <findLineContent dst="generom" content="SEXO@M@F" threshold="1"/>
                    <assignIfContent src="generom" dst="genero" value="F"
                        op="exists"
                        overwrite="false"
                    />
                    <assignField src="genero" field="Gender"/>

                    <findLineMatch dst="idcard" regex="^E([0-9]{8})$" value="E([N]$1)" overwrite="false"/>
                    <rejectIfNotValid src="idcard"/>
                    <assignField src="idcard" field="IDCardNumber"/>

                </ML>
            </Front>

            <Back>
                <ML cols="1" split_by="elements" separation="0.05" space_separation="0.1">
                    
                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine3" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>

                    <matchIfValid src="mrzLine1" dst="mrzId" overwrite="false"
                        regex="^([Il1][DO0])"
                        value="([U]$1)"
                    />
                    <rejectIfValid src="mrzId" reason="DocumentNotExpected"/>

                    <findLineContent dst="res1" content="ASPECTOS@LABORALES@O@MOTIVO@DE@CONCESIÓN" threshold="0.4"/>
                    <findLineContent dst="res2" content="FAMILIAR@CIUDADANO@DE@LA@UNION" threshold="0.4"/>

                    <!-- We search for IXESP in the MRZ -->
                    <findLineMatch dst="res3"
                        regex="(I ?X ?E ?S ?P.*\&lt;\s?\&lt;?.*)"
                        value="($1)"
                    />
                    <rejectIfNotValid3 src="res1" src2="res2" src3="res3" reason="DocumentNotExpected"/>

                </ML>

                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2" regex="IX"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="ESP"/>
                    <field id="IDCardNumber"    line="1" starts="6" count="9"/>
                    <field id="DocumentNumber"  line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="MX" iso="MEX">

        <Version id="PresetFc" type="TD1" document_type="FOC">
            <Front>
                <BLINKID>
                    <ML>
                        <field id="NUE" move="DocumentAdditionalNumber"/>
                    </ML>
                </BLINKID>
            </Front>
            <Back>
                <BLINKID>
                    <MRZ>
                        <field id="Number" move="DocumentNumber"/>
                    </MRZ>
                    <BARCODE>
                        <field id="Number" move="DocumentNumber"/>
                    </BARCODE>
                </BLINKID>
            </Back>
        </Version>

        <Version id="v1" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="elements" separation="0.1" space_separation="0.1">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="res0" content="RESIDENTE@PERMANENTE" threshold="0.2"/>
                    <findLineContent dst="res1" content="RESIDENTE@TEMPORAL" threshold="0.2"/>
                    <rejectIfNotValid2 src="res0" src2="res1" reason="DocumentNotExpected"/>

                    <findLineContent dst="nom" content="Nombre@@@Name" threshold="0.3"/>
                    <findLineContent dst="nacionalidad" content="Nacionalidad@@@Nationality" threshold="0.3"/>
                    <assignIfValid dst="nat" src="nacionalidad" offset="+1" overwrite="false"/>
                    <findLineMatch dst="dob"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch src="lineCURP" dst="curp"
                        regex="([A-Z][AEIOUX][A-Z]{2}\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])[HM](?:AS|B[CS]|C[CLMSH]|D[FG]|G[TR]|HG|JC|M[CNS]|N[ETL]|OC|PL|Q[TR]|S[PLR]|T[CSL]|VZ|YN|ZS)[B-DF-HJ-NP-TV-Z]{3}[A-Z\d]\d)"
                        value="($1)"
                        overwrite="false"
                    />
                    <findLineMatch src="lineCURP" dst="curp"
                        regex="([A-Za-z]{4})([0-9A-Za-z]{6})([A-Za-z]{6})([A-Za-z0-9])([0-9A-Za-z])"
                        value="([U]$1)([N]$2)([U]$3)([N]$4)([N]$5)"
                        overwrite="false"
                    />
                    <findLineMatch src="lineCURP" dst="curp"
                        regex="(?:[cCO0o][uU][RnBH][PRp]) ?([A-Z0-9]{18})"
                        value="($1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="CURPstr"
                        regex="^([cCO0o][uU][RnBH][PRp])$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignIfValid dst="lineCURP" src="CURPstr" offset="1" overwrite="false"/>
                    <matchIfValid src="lineCURP" dst="curp"
                        regex="([A-Z0-9]{19})"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="curp" reason="DocumentNotExpected"/>
                    <findLineMatch dst="doi" overwrite="false"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch dst="doe" overwrite="false"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch dst="nue" src="nueStr"
                        regex="([0-9oOl]{13})"
                        value="([N]$1)"
                    />
                    <findLineContent dst="paiss" content="Pais@@@Country" threshold="0.3"/>
                    <assignIfValid dst="pais" src="paiss" offset="+1" overwrite="false"/>
                    <findLineContent dst="generoh" content="Hombre" threshold="0.2"/>
                    <assignIfContent src="generoh" dst="genero" value="M"
                        op="exists"
                        overwrite="false"
                    />
                    <findLineContent dst="generom" content="Mujer" threshold="0.2"/>
                    <assignIfContent src="generom" dst="genero" value="F"
                        op="exists"
                        overwrite="false"
                    />
                    <assignIfValid dst="fn" src="nom" offset="+1" overwrite="false"/>

                    <assignField src="fn" field="FirstName"/>
                    <assignField src="fn" field="FullName"/>
                    <assignField src="nat" field="Nationality"/>
                    <assignField src="dob" field="DateOfBirth"/>
                    <assignField src="curp" field="CURP"/>
                    <assignField src="curp" field="DocumentNumber"/>
                    <assignField src="doi" field="DateOfIssue"/>
                    <assignField src="doe" field="DateOfExpiry"/>
                    <assignField src="nue" field="NUE"/>
                    <assignField src="pais" field="NationalityCountry"/>
                    <assignField src="genero" field="Gender"/>
                </ML>

                <BARCODE types="CODE128" decode="splitBy: " charset="UTF-8">
                    <field id="Number" data="0"/>
                </BARCODE>
            </Front>

            <Back>
                <ML cols="2" split_by="elements" separation="0.1" space_separation="0.1">
                    <findLineContent dst="res0" content="Este@documento@acredita" threshold="0.4"/>
                    <findLineContent dst="res1" content="Este@documento@acredita@situación@migratoria" threshold="0.2"/>
                    <findLineContent dst="res2" content="Este@documento@acredita@situación@migratoria@regular" threshold="0.2"/>
                    <rejectIfNotValid3 src="res0" src2="res1" src3="res2" reason="DocumentNotExpected"/>
                </ML>

                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="MEX"/>
                    <field id="Number"          line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="PE" iso="PER">
        <Version id="Extranjeria" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="1" split_by="elements" separation="0.08" y_separation="0.3" space_separation="0.07">

                    <postProcessImage dst=""
                        nonLinear="false"
                        rMin="0.000" rMax="0.999"
                        gMin="0.000" gMax="0.999"
                        bMin="0.000" bMax="0.999"
                        rWeight="0.000"
                        gWeight="0.000"
                        bWeight="1.000"
                    />

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineMatch dst="docNumber"
                        regex="([0-9Ool]{9})"
                        value="([N]$1)"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineContent dst="rdp" content="REPUBLICA@DEL@PERÚ" threshold="0.3"/>
                    <findLineContent dst="sndm" content="SUPERINTENDENCIA@NACIONAL@DE@MIGRACIONES" threshold="0.3"/>
                    <rejectIfNotValid2 src="rdp" src2="sndm" reason="DocumentNotExpected"/>

                    <findLineMatch dst="dob" overwrite="false"
                        regex="([0-3oOl][0-9oOl]) ?([a-zA-Z0-9oOl]{3}) ?([1-2l][0-9oOl]{3})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <assignField src="dob" field="DateOfBirth"/>

                    <findLineMatch dst="sex"
                        regex="^(M|F)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="sex" field="Gender"/>

                    <findLineMatch dst="ec"
                        regex="^(S|C|D|V)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="ec"
                        regex=" (S|C|D|V)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="ec" field="CivilStatus"/>

                    <findLineContent dst="apeStr" content="APELLIDOS" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="nomStr" content="NOMBRES" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="natStr" content="NACIONALIDAD" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="sexStr" content="SEXO" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="ecStr" content="ESTADO@CIVIL" threshold="0.3" overwrite="false"/>

                    <findLineFrom dst="ln" src="apeStr" direction="RIGHT" overwrite="false"/>
                    <findLineFrom dst="fn" src="nomStr" direction="RIGHT" overwrite="false"/>
                    <findLineFrom dst="nat" src="natStr" direction="RIGHT" overwrite="false"/>

                    <findLineFrom dst="ln" src="fn" direction="TOP" overwrite="false"/>
                    <findLineFrom dst="fn" src="ln" direction="BOTTOM" overwrite="false"/>
                    <findLineFrom dst="fn" src="nat" direction="TOP" overwrite="false"/>
                    <findLineFrom dst="nat" src="fn" direction="BOTTOM" overwrite="false"/>

                    <rejectIfNotValid src="fn"/>
                    <rejectIfNotValid src="ln"/>

                    <modifyIfValid dst="fn" op="U"/>
                    <assignField src="fn" field="FirstName"/>

                    <modifyIfValid dst="ln" op="U"/>
                    <assignField src="ln" field="LastName"/>

                    <modifyIfValid dst="nat" op="U"/>
                    <assignField src="nat" field="Nationality"/>

                </ML>
            </Front>

            <Back>                
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>

                <ML cols="5" split_by="lines" separation="0.0" y_separation="0.0" space_separation="0.07">

                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <rejectIfNotValid src="mrzLine1" reason="DocumentNotExpected"/>
                    <rejectIfNotValid src="mrzLine2" reason="DocumentNotExpected"/>

                    <findLineContent dst="mig" content="MIGRACIONES" threshold="3" overwrite="false"/>
                    <rejectIfNotValid src="mig" reason="DocumentNotExpected"/>

                    <findLineContent dst="nPassStr" content="N@@Pasaporte" threshold="0.3" overwrite="false"/>

                    <findLineMatch dst="doinsc" overwrite="false"
                        regex="([0-3oOl][0-9oOl]) ?([a-zA-Z]{3}) ?([1-2l][0-9oOl]{3})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <assignField src="doinsc" field="DateOfInscription"/>

                    <findLineMatch dst="doi" overwrite="false"
                        regex="([0-3oOl][0-9oOl]) ?([a-zA-Z]{3}) ?([1-2l][0-9oOl]{3})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <assignField src="doi" field="DateOfIssue"/>

                    <findLineMatch dst="doe" overwrite="false"
                        regex="([0-3oOl][0-9oOl]) ?([a-zA-Z]{3}) ?([1-2l][0-9oOl]{3})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <assignField src="doe" field="DateOfExpiry"/>

                    <findLineFrom dst="nPass" src="doinsc" direction="TOP" overwrite="false"/>
                    <findLineFrom dst="nPass" src="nPassStr" direction="RIGHT" overwrite="false"/>
                    <assignField src="nPass" field="PassportNumber"/>

                    <replaceIfValid dst="mrzLine1" content=" " replace=""/>
                    <replaceIfValid dst="mrzLine2" content=" " replace=""/>

                    <matchIfValid dst="docNumber" src="mrzLine2" overwrite="false"
                        regex="([0-9oOl]{9})[0-9oOl](?:[A-Za-z0-9]{3})(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])[0-9oOl](?:M|F|X)(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])"
                        value="([N]$1)"
                    />
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <matchIfValid dst="nat" src="mrzLine2" overwrite="false"
                        regex="(?:[0-9oOl]{9})[0-9oOl]([A-Za-z0-9]{3})(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])[0-9oOl](?:M|F|X)(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])"
                        value="([U]$1)"
                    />
                    <assignField src="nat" field="Nationality"/>

                    <matchIfValid dst="dob" src="mrzLine2" overwrite="false"
                        regex="(?:[0-9oOl]{9})[0-9oOl](?:[A-Za-z0-9]{3})([0-9oOl]{2})([0-1oOl][0-9oOl])([0-3oOl][0-9oOl])[0-9oOl](?:M|F|X)(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])"
                        value="([N]$3)/([N]$2)/([YP]$1)"
                    />
                    <assignField src="dob" field="DateOfBirth"/>

                    <matchIfValid dst="sex" src="mrzLine2" overwrite="false"
                        regex="(?:[0-9oOl]{9})[0-9oOl](?:[A-Za-z0-9]{3})(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])[0-9oOl](M|F|X)(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])"
                        value="($1)"
                    />
                    <assignField src="sex" field="Gender"/>

                    <matchIfValid dst="doe" src="mrzLine2" overwrite="false"
                        regex="(?:[0-9oOl]{9})[0-9oOl](?:[A-Za-z0-9]{3})(?:[0-9oOl]{2})(?:[0-1oOl][0-9oOl])(?:[0-3oOl][0-9oOl])[0-9oOl](?:M|F|X)([0-9oOl]{2})([0-1oOl][0-9oOl])([0-3oOl][0-9oOl])"
                        value="([N]$3)/([N]$2)/([YF]$1)"
                    />
                    <assignField src="doe" field="DateOfExpiry"/>

                </ML>
            </Back>
        </Version>

        <Version id="PTP" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="lines" separation="0.04" y_separation="0.04" space_separation="0.7">
                    <postProcessImage dst=""
                        nonLinear="false"
                        rMin="0.000" rMax="0.999"
                        gMin="0.000" gMax="0.999"
                        bMin="0.000" bMax="0.999"
                        rWeight="0.500"
                        gWeight="0.000"
                        bWeight="0.500"
                    />

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="res1" content="REPÚBLICA@DEL@PERÚ" threshold="0.2"/>
                    <findLineContent dst="res2" content="SUPERINTENDENCIA@NACIONAL@DE@MIGRACIONES" threshold="0.3"/>
                    <findLineContent dst="res3" content="PERMISO@TEMPORAL@DE@PERMANENCIA@PTP" threshold="0.3"/>
                    <rejectIfNotValid3 src="res1" src2="res2" src3="res3" reason="DocumentNotExpected"/>

                    <findLineMatch dst="cuiNumber"
                        regex="([0-9oOl]{9})"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="cuiNumber" reason="DocumentNotExpected"/>

                    <findLineContent dst="ln1" content="APELLIDOS@" threshold="0.2"/>
                    <assignIfValid dst="ln" src="ln1" offset="+1" overwrite="false"/>
                    <findLineContent dst="fn1" content="NOMBRES@" threshold="0.2"/>
                    <assignIfValid dst="fn" src="fn1" offset="+1" overwrite="false"/>
                    <findLineContent dst="natio" content="NACIONALIDAD@" threshold="0.2"/>
                    <assignIfValid dst="nat" src="natio" offset="+1" overwrite="false"/>
                    <findLineContent dst="dobb" content="NACIMIENTO@" threshold="0.2"/>
                    <assignIfValid dst="dobstr" src="dobb" offset="+1" overwrite="false"/>
                    <matchIfValid src="dobstr" dst="dob"
                        regex="([0-9]{2})(?: |[^A-Za-z0-9])*([a-zA-Z0-9]{3})(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/([M]$2)/($3)"
                    />
                    <findLineMatch dst="dob"
                        regex="([0-9]{2})(?: |[^A-Za-z0-9])*([a-zA-Z0-9]{3})(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/([M]$2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="gen"
                        regex="^(M|F)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <findLineContent dst="ecc" content="ESTADO@CIVIL@" threshold="0.2"/>
                    <assignIfValid dst="ec" src="ecc" offset="+1" overwrite="false"/>

                    <assignField src="cuiNumber" field="CUI"/>
                    <assignField src="cuiNumber" field="DocumentNumber"/>
                    <assignField src="ln" field="LastName"/>
                    <assignField src="fn" field="FirstName"/>
                    <assignField src="nat" field="Nationality"/>
                    <assignField src="dob" field="DateOfBirth"/>
                    <assignField src="gen" field="Gender"/>
                    <assignField src="ec" field="CivilStatus"/>
                </ML>
            </Front>

            <Back>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>

                <ML cols="4" split_by="elements" separation="0.04" space_separation="0.04">
                    <findLineContent dst="res1" content="MIGRACIONES" threshold="0.2"/>
                    <findLineContent dst="res3" content="PERU" threshold="0.2"/>
                    <rejectIfNotValid2 src="res1" src2="res2" reason="DocumentNotExpected"/>

                    <!-- MRZ by OCR: This MRZ is not standard -->
                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <replaceIfValid dst="mrzLine2" content=" " replace=""/>

                    <matchIfValid src="mrzLine2" dst="cuiNumber"
                        regex="^([0-9oOl]{9})"
                        value="([N]$1)"
                    />
                    <matchIfValid src="mrzLine2" dst="nat"
                        regex="([A-Z]{3})"
                        value="([U]$1)"
                    />
                    <matchIfValid src="mrzLine2" dst="dob"
                        regex="[A-Z]{3}([0-9]{2})([0-9]{2})([0-9]{2})"
                        value="($3)/($2)/([YP]$1)"
                    />
                    <matchIfValid src="mrzLine2" dst="gen"
                        regex="[0-9oOl]{7}([A-Z])[0-9oOl]{7}"
                        value="([U]$1)"
                    />

                    <!-- OCR -->
                    <findLineMatch dst="str"
                        regex="^([DO0][eEB][pPo][aA4][rRHK][tTI][aA4][Mm][eEB][Nn][tTI][OQo0Ọ]:? ?)(.*)"
                        value="($2)"
                    />
                    <matchIfValid src="str" dst="depart"
                        regex="^(.*)[Ppo][rRHK][OQo0Ọ][vV][iIl1][Nn][Cc][iIl1][aA4]"
                        value="($1)"
                    />
                    <matchIfValid src="str" dst="prov"
                        regex="[Ppo][rRHK][OQo0Ọ][vV][iIl1][Nn][Cc][iIl1][aA4]:? ?(.*)"
                        value="($1)"
                    />
                    <findLineMatch dst="dist"
                        regex="^([DO0][iIl1][sS][t][rRHK][iIl1][tTI][OQo0Ọ]:? ?)(.*)"
                        value="($2)"
                    />
                    <findLineMatch dst="address"
                        regex="^([DO0][iIl1][rRHK][eEB][Cc][Cc][iIl1][OQo0Ọó][nN]:? ?)(.*)"
                        value="($2)"
                    />
                    <findLineMatch dst="cipNumber"
                        regex="([0-9oOl]{8})$"
                        value="([N]$1)"
                    />
                    <findLineMatch dst="doa"
                        regex="^([0-9lIoOSs]{2})(?:,|\.|\/|-| )?([a-zA-Z0-9]{3})(?:[a-zA-Z0-9]*)(?:,|\.|\/|-| )?([0-9lIoOSs]{4})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <findLineMatch dst="doi"
                        regex="^([0-9lIoOSs]{2})(?:,|\.|\/|-| )?([a-zA-Z0-9]{3})(?:[a-zA-Z0-9]*)(?:,|\.|\/|-| )?([0-9lIoOSs]{4})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <findLineMatch dst="doe"
                        regex="([0-9lIoOSs]{2})(?:,|\.|\/|-| )?([a-zA-Z0-9]{3})(?:[a-zA-Z0-9]*)(?:,|\.|\/|-| )?([0-9lIoOSs]{4})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <findLineMatch dst="expPlace"
                        regex="^([L][Uu][gG6]\.? ?[EB][x][po][eEB][db][iIl1][Cc][iIl1][OQo0Ọó][nN]:? ?)(.*)"
                        value="($2)"
                    />

                    <assignField src="cuiNumber" field="CUI"/>
                    <assignField src="cuiNumber" field="DocumentNumber"/>
                    <assignField src="nat" field="Nationality"/>
                    <assignField src="dob" field="DateOfBirth"/>
                    <assignField src="gen" field="Gender"/>
                    <assignField src="depart" field="State"/>
                    <assignField src="prov" field="AddressState"/>
                    <assignField src="dist" field="AddressDistrict"/>
                    <assignField src="address" field="Address"/>
                    <assignField src="cipNumber" field="CIPNumber"/>
                    <assignField src="doa" field="DateOfApproval"/>
                    <assignField src="doi" field="DateOfIssue"/>
                    <assignField src="doe" field="DateOfExpiry"/>
                    <assignField src="expPlace" field="PlaceOfIssue"/>
                </ML>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="GT" iso="GTM">
        <Version id="Extranjeria" type="TD1" document_type="FOC" priority="PDF417,BARCODE,ML,MRZ,OCR,INPUT">
            <Front>
                <FACE/>
                <ML cols="4" split_by="elements" separation="0.035" space_separation="0.10">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <!-- We try to find if ID is a driver's license to reject it -->
                    <findLineContent dst="ddt" content="DEPARTAMENTO@DE@TRÁNSITO" threshold="5"/>
                    <rejectIfValid src="ddt" reason="DocumentNotExpected"/>

                    <findLineContent dst="exdo" content="EXTRANJERO@DOMICILIADO" threshold="5"/>
                    <rejectIfNotValid src="exdo" reason="DocumentNotExpected"/>

                    <assignResult src="$_GTM/ForeignCard" field="DocumentModel"/>

                    <findLineMatch dst="cui" src="cuiStr"
                        regex="([0-9oOl]{4}) ?([0-9oOl]{5}) ?([0-9oOl]{4})"
                        value="([N]$1) ([N]$2) ([N]$3)"
                    />
                    <matchIfValid dst="docNumber" src="cuiStr"
                        regex="([0-9oOl]{4}) ?([0-9oOl]{5}) ?([0-9oOl]{4})"
                        value="([N]$1)([N]$2)"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>
                    <assignField src="cui" field="CUI"/>

                    <findLineContent dst="rdg" content="REPÚBLICA@DE@GUATEMALA@@CENTROAMÉRICA" threshold="0.3"/>
                    <findLineContent dst="rnp_dpi_dpi" content="Registro@Nacional@de@las@Personas@@@Documento@Personal@de@Identificación@@@DPI" threshold="0.3"/>
                    <findLineContent dst="rnp_dpi" content="Registro@Nacional@de@las@Personas" threshold="0.3"/>
                    <findLineContent dst="dpi" content="Documento@Personal@de@Identificación" threshold="0.3"/>
                    <findLineContent dst="cui" content="CÓDIGO@ÚNICO@DE@IDENTIFICACIÓN" threshold="0.3"/>

                    <rejectIfNotValid3 src="rnp_dpi_dpi" src2="rnp_dpi" src3="dpi" reason="DocumentNotExpected"/>

                    <findLineContent dst="nom" content="NOMBRE" threshold="0.33"/>
                    <findLineContent dst="ape" content="APELLIDO" threshold="0.33"/>

                    <rejectIfNotValid src="nom"/>
                    <rejectIfNotValid src="ape"/>

                    <!-- We block the line "SEXO" early to prevent reading "SEXO" as the second last name -->
                    <findLineContent dst="sexo" content="SEXO" threshold="1" mode="reverse"/>
                    <findLineContent dst="sexMstr" content="MASCULINO" threshold="0.33" mode="reverse"/>
                    <findLineContent dst="sexFstr" content="FEMENINO" threshold="0.33" mode="reverse"/>

                    <!-- We block the line "NACIONALIDAD" to prevent reading it as second last name -->
                    <findLineContent dst="nacionalidad" content="NACIONALIDAD" threshold="0.33" mode="reverse"/>
                    <assignIfValid dst="nat" src="nacionalidad" offset="+1" overwrite="false"/>
                    <assignField src="nat" field="Nationality" block="true"/>

                    <assignIfValid dst="fn1" src="nom" offset="+1" overwrite="false"/>
                    <assignIfValid dst="fn2" src="nom" offset="+2" overwrite="false"/>
                    <modifyIfValid dst="fn1" op="U"/>
                    <modifyIfValid dst="fn2" op="U"/>
                    <assignIfValid dst="fn" src="fn1"/>
                    <concatenateIfValid dst="fn" src="fn2" prefix=" " suffix=""/>
                    <assignField src="fn1" field="FirstName1" block="true"/>
                    <assignField src="fn2" field="FirstName2" block="true"/>
                    <assignField src="fn" field="FirstName" block="true"/>

                    <assignIfValid dst="ln1" src="ape" offset="+1" overwrite="false"/>
                    <assignIfValid dst="ln2" src="ape" offset="+2" overwrite="false"/>
                    <assignIfValid dst="ln3" src="ape" offset="+3" overwrite="false"/>
                    <modifyIfValid dst="ln1" op="U"/>
                    <modifyIfValid dst="ln2" op="U"/>
                    <modifyIfValid dst="ln3" op="U"/>
                    <assignIfValid dst="ln" src="ln1"/>
                    <concatenateIfValid dst="ln" src="ln2" prefix=" " suffix=""/>
                    <concatenateIfValid dst="ln" src="ln3" prefix=" " suffix=""/>
                    <assignField src="ln1" field="LastName1" block="true"/>
                    <assignField src="ln2" field="LastName2" block="true"/>
                    <assignField src="ln3" field="LastName3" block="true"/>
                    <assignField src="ln" field="LastName" block="true"/>

                    <assignIfContent src="sexMstr" dst="sex" value="M"
                        op="exists"
                        overwrite="false"
                    />
                    <assignIfContent src="sexFstr" dst="sex" value="F"
                        op="exists"
                        overwrite="false"
                    />
                    <assignIfValid dst="sex" src="sexo" offset="+1" overwrite="false"/>
                    <assignField src="sex" field="Gender" block="true"/>

                    <findLineMatch dst="dob" overwrite="false"
                        regex="([0-3oOl][0-9oOl]) ?([a-zA-Z0-9oOl]{3}) ?([1-2l][0-9oOl]{3})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <assignField src="dob" field="DateOfBirth"/>

                    <findLineMatch dst="doi" overwrite="false"
                        regex="([0-3oOl][0-9oOl]) ?([a-zA-Z0-9oOl]{3}) ?([1-2l][0-9oOl]{3})"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />
                    <assignField src="doi" field="DateOfIssue"/>

                </ML>
            </Front>
            
            <Back>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>
                <MRZ optional="yes">
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="GTM"/>
                    <field id="DocumentNumber"  line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
                <ML cols="5" split_by="lines" separation="0.01" space_separation="0.10">

                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine3" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <rejectIfNotValid3 src="mrzLine1" src2="mrzLine2" src3="mrzLine3" reason="DocumentNotExpected"/>
                    <replaceIfValid dst="mrzLine1" content=" " replace=""/>
                    <replaceIfValid dst="mrzLine2" content=" " replace=""/>
                    <replaceIfValid dst="mrzLine3" content=" " replace=""/>

                    <findLineContent dst="ldn" content="LUGAR@DE@NACIMIENTO" threshold="0.33" overwrite="false"/>
                    <findLineContent dst="vec" content="VECINDAD" threshold="0.33" overwrite="false"/>
                    <findLineContent dst="vec" content="@@VECINDAD" threshold="0.33" overwrite="false"/>
                    <findLineContent dst="pub" content="PUEBLO" threshold="0.33" overwrite="false"/>
                    <rejectIfNotValid2 src="ldn" src2="vec" reason="DocumentNotExpected"/>

                    <findLineMatch dst="pobCode"
                        regex="L ?[:\-\.]? ?([0-9A-Z\-\/\| ]+) ?F ?[:\-\.]? ?([0-9]+) ?P ?[:\-\.]? ?([0-9]+)"
                        value="L:($1) F:([N]$2) P:([N]$3)"
                        overwrite="false"
                    />
                    <assignField src="pobCode" field="PlaceOfBirthCode"/>

                    <!-- We read Pueblo field -->
                    <assignIfValid dst="vil" src="pub" offset="1" overwrite="false"/>
                    <modifyIfValid dst="vil" op="U"/>
                    <assignField src="vil" field="Village" block="true"/>

                    <!-- We read Vecindad field -->
                    <assignIfValid dst="nei1" src="vec" offset="1" overwrite="false"/>
                    <assignIfValid dst="nei2" src="vec" offset="2" overwrite="false"/>

                    <assignIfValid dst="nei" src="nei1" overwrite="false"/>
                    <concatenateIfValid dst="nei" src="nei2" prefix=" - " suffix=""/>

                    <modifyIfValid dst="nei1" op="U"/>
                    <modifyIfValid dst="nei2" op="U"/>
                    <modifyIfValid dst="nei" op="U"/>
                    <assignField src="nei1" field="Neighbourhood1" block="true"/>
                    <assignField src="nei2" field="Neighbourhood2" block="true"/>
                    <assignField src="nei" field="Neighbourhood"/>

                    <!-- We read Lugar de nacimiento field -->
                    <assignIfValid dst="pob1" src="ldn" offset="1" overwrite="false"/>
                    <assignIfValid dst="pob2" src="ldn" offset="2" overwrite="false"/>
                    <assignIfValid dst="pob3" src="ldn" offset="3" overwrite="false"/>

                    <assignIfValid dst="pob" src="pob1" overwrite="false"/>
                    <concatenateIfValid dst="pob" src="pob2" prefix=" - " suffix=""/>
                    <concatenateIfValid dst="pob" src="pob3" prefix=" - " suffix=""/>

                    <assignIfContent dst="pob1" value=""
                        op="not_exists"
                        overwrite="false"
                    />
                    <assignIfContent dst="pob2" value=""
                        op="not_exists"
                        overwrite="false"
                    />

                    <modifyIfValid dst="pob1" op="U"/>
                    <modifyIfValid dst="pob2" op="U"/>
                    <modifyIfValid dst="pob3" op="U"/>
                    <modifyIfValid dst="pob" op="U"/>
                    <assignField src="pob1" field="PlaceOfBirth1" block="true"/>
                    <assignField src="pob2" field="PlaceOfBirth2" block="true"/>
                    <assignField src="pob3" field="PlaceOfBirth3" block="true"/>
                    <assignField src="pob" field="PlaceOfBirth"/>

                    <findLineMatch dst="doe" overwrite="false"
                        regex="^([0-3oOl][0-9oOl]) ?([a-zA-Z0-9oOl]{3}) ?([1-2l][0-9oOl]{3})$"
                        value="([N]$1)/([M]$2)/([N]$3)"
                    />

                    <findLineContent dst="ec" content="ESTADO@CIVIL" threshold="0.33"/>
                    <assignIfValid dst="maritalStatusStr" src="ec" offset="1" overwrite="false"/>
                    <modifyIfValid dst="maritalStatusStr" op="U"/>

                    <assignFromList src="maritalStatusStr" dst="maritalStatus"
                        list="SOLTERO,CASADO,VIUDO,DIVORCIADO,SEPARADO"
                        threshold="0.3"
                    />
                    <assignField src="maritalStatus" field="MaritalStatus"/>

                    <findLineMatch dst="serial"
                        regex="^([0-9oOlBASsG]{13})$"
                        value="([N]$1)"
                        overwrite="false"
                    />

                    <!-- We try to read MRZ -->
                    <matchIfValid src="mrzLine2" dst="doe"
                        regex="(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])[0-9](?:[MF])([0-9]{2})([0-1][0-9])([0-3][0-9])"
                        value="([N]$3)/([N]$2)/([YF]$1)"
                        overwrite="false"
                    />
                    <assignField src="doe" field="DateOfExpiry"/>

                    <matchIfValid src="mrzLine2" dst="dob"
                        regex="([0-9]{2})([0-1][0-9])([0-3][0-9])[0-9](?:[MF])(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])"
                        value="([N]$3)/([N]$2)/([YP]$1)"
                        overwrite="false"
                    />
                    <assignField src="dob" field="DateOfBirth"/>

                    <matchIfValid src="mrzLine2" dst="gender"
                        regex="(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])[0-9]([MF])(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="gender" field="Gender"/>

                    <!-- We test again for Serial number -->
                    <findLineMatch dst="serial"
                        regex="^([0-9oOlBASsG]{13})"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <assignField src="serial" field="SerialNumber"/>

                </ML>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="BO" iso="BOL">
        <Version id="v1" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="elements" separation="0.05" space_separation="0.1">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="ndc" content="Número@de@cédula@" threshold="0.3"/>
                    <rejectIfValid src="ndc" reason="DocumentNotExpected"/>

                    <findLineContent dst="line1" content="Estado@Plurinacional@de@Bolivia" threshold="0.3"/>
                    <findLineContent dst="line2" content="Servicio@General@de@Identificación" threshold="0.3"/>
                    <findLineContent dst="line3" content="CÉDULA@DE@IDENTIDAD@DE@EXTRAN" threshold="0.3"/>
                    <rejectIfNotValid3 src="line1" src2="line2" src3="line3" reason="DocumentNotExpected"/>

                    <findLineMatch src="nom" dst="nombres"
                        regex="^[Nn][Oo0][MNH][Bb8][RHK][EeB][S5R][:;]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch src="nom" dst="nombres"
                        regex="[Nn][Oo0][MNH][Bb8][RHK][EeB][S5R][:;]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch src="ape" dst="apellidos"
                        regex="^[A4][Pp][EeB][Ll]?[Ll]?[iIlU][DO][Oo0][S5][:;]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch src="ape" dst="apellidos"
                        regex="[A4][Pp][EeB][Ll]?[Ll]?[iIlU][DO][Oo0][S5][:;]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <concatenateIfValid dst="fullname" src="nombres" prefix=" " suffix=""/>
                    <concatenateIfValid dst="fullname" src="apellidos" prefix=" " suffix=""/>
                    
                    <findLineMatch src="gen" dst="genero"
                        regex="^[Gg][EeB][MnNnH][EeB][Rr8][Oo0][:;]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch src="gen" dst="genero"
                        regex="[Gg][EeB][MnNnH][EeB][Rr8][Oo0][:;]? ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch src="nat" dst="natio"
                        regex="^[Nn][A4][cC][iIl][oO0][Nn][A4][Ll][iIl][DO][A4][DO][:;] ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch src="nat" dst="natio"
                        regex="[Nn][A4][cC][iIl][oO0][Nn][A4][Ll][iIl][DO][A4][DO][:;] ?(.+)"
                        value="([U]$1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="dob" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch src="doc" dst="docNumber"
                        regex="([A-Z])-([0-9oOlBASsG]{7})$"
                        value="([U]$1)-([N]$2)"
                        overwrite="false"
                    />
                    <findLineMatch dst="doe" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />

                    <assignField src="nombres" field="FirstName"/>
                    <assignField src="apellidos" field="LastName"/>
                    <assignField src="fullname" field="FullName"/>
                    <assignField src="genero" field="Gender"/>
                    <assignField src="natio" field="Nationality"/>
                    <assignField src="dob" field="DateOfBirth"/>
                    <assignField src="docNumber" field="DocumentNumber"/>
                    <assignField src="doe" field="DateOfExpiry"/>
                </ML>
            </Front>

            <Back>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>

                <ML cols="3" split_by="lines" separation="0.01" space_separation="0.10">
                    <!-- Get MRZ clean lines -->
                    <findLineMatch dst="mrzLine1" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine2" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <findLineMatch dst="mrzLine3" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <rejectIfNotValid3 src="mrzLine1" src2="mrzLine2" src3="mrzLine3" reason="DocumentNotExpected"/>
                    <replaceIfValid dst="mrzLine1" content=" " replace=""/>
                    <replaceIfValid dst="mrzLine2" content=" " replace=""/>
                    <replaceIfValid dst="mrzLine3" content=" " replace=""/>

                    <findLineContent dst="line1" content="LICENCIAS@PARA@CONDUCIR" threshold="0.3"/>
                    <rejectIfNotValid src="line1" reason="DocumentNotExpected"/>

                    <!-- We try to read MRZ -->
                    <matchIfValid src="mrzLine2" dst="doe"
                        regex="(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])[0-9](?:[MF])([0-9]{2})([0-1][0-9])([0-3][0-9])"
                        value="([N]$3)/([N]$2)/([YF]$1)"
                        overwrite="false"
                    />
                    <matchIfValid src="mrzLine2" dst="dob"
                        regex="([0-9]{2})([0-1][0-9])([0-3][0-9])[0-9](?:[MF])(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])"
                        value="([N]$3)/([N]$2)/([YP]$1)"
                        overwrite="false"
                    />
                    <matchIfValid src="mrzLine2" dst="gender"
                        regex="(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])[0-9]([MF])(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])"
                        value="($1)"
                        overwrite="false"
                    />
                    <matchIfValid src="mrzLine2" dst="natio"
                        regex="(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])[0-9](?:[MF])(?:[0-9]{2})(?:[0-1][0-9])(?:[0-3][0-9])[0-9]([A-Z]{3})"
                        value="($1)"
                        overwrite="false"
                    />

                    <assignField src="doe" field="DateOfExpiry"/>
                    <assignField src="dob" field="DateOfBirth"/>
                    <assignField src="gender" field="Gender"/>
                    <assignField src="natio" field="Nationality"/>
                </ML>
            </Back>
        </Version>

        <Version id="v2" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="lines" separation="0.05" space_separation="0.1">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="ndc" content="Número@de@cédula@" threshold="0.3"/>
                    <rejectIfNotValid src="ndc" reason="DocumentNotExpected"/>

                    <findLineContent dst="line1" content="ESTADO@PLURINACIONAL@DE@BOLIVIA" threshold="0.3"/>
                    <findLineContent dst="line2" content="SERVICIO@GENERAL@DE@IDENTIFICACIÓN@PERSONAL" threshold="0.3"/>
                    <findLineContent dst="line3" content="SEGIP" threshold="0.2"/>
                    <findLineContent dst="cedula" content="CÉDULA@DE@IDENTIDAD@DE@EXTRANJERO" threshold="0.3"/>
                    <rejectIfNotValid4 src="line1" src2="line2" src3="line3" src4="cedula" reason="DocumentNotExpected"/>

                    <findLineMatch dst="dob" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch dst="doi" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch dst="doe" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <findLineMatch src="doc" dst="docNumber"
                        regex="([A-Z])-([0-9oOlBASsG]{8})$"
                        value="([U]$1)-([N]$2)"
                        overwrite="false"
                    />
                    <findLineContent dst="gen" content="Sexo@" threshold="0.3"/>
                    <assignIfValid dst="genero" src="gen" offset="+1" overwrite="false"/>
                    <findLineContent dst="nat" content="Nacionalidad@" threshold="0.3"/>
                    <assignIfValid dst="natio" src="nat" offset="+1" overwrite="false"/>
                    <findLineContent dst="nom" content="Nombres@@Apellidos@" threshold="0.3"/>
                    <assignIfValid dst="ln1" src="cedula" offset="+1" overwrite="false"/>
                    <assignIfValid dst="ln1" src="nom" offset="+1" overwrite="false"/>
                    <assignIfValid dst="ln2" src="nat" offset="-1" overwrite="false"/>
                    <concatenateIfValid dst="ln1" src="ln2" prefix=" " suffix=""/>
                    <splitIfValid2 src="ln1" dst1="nombres" dst2="apellidos" by="/"/>

                    <assignField src="dob" field="DateOfBirth"/>
                    <assignField src="doi" field="DateOfIssue"/>
                    <assignField src="doe" field="DateOfExpiry"/>
                    <assignField src="docNumber" field="DocumentNumber"/>
                    <assignField src="natio" field="Nationality"/>
                    <assignField src="genero" field="Gender"/>
                    <assignField src="nombres" field="FirstName"/>
                    <assignField src="apellidos" field="LastName"/>
                    <assignField src="ln1" field="FullName"/>
                </ML>
            </Front>

            <Back>
                <BARCODE types="QRCODE" optional="yes"/>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>
                <ML cols="4" split_by="lines" separation="0.05" space_separation="0.1">
                    <findLineContent dst="dir" content="Dirección" threshold="0.2"/>
                    <assignIfValid dst="address" src="dir" offset="+1" overwrite="false"/>
                    <assignField src="address" field="Address" block="true"/>

                    <findLineContent dst="res" content="Resolución@Administrativa@@DIGEMIG@" threshold="0.3"/>
                    <assignIfValid dst="resolution" src="res" offset="+1" overwrite="false"/>
                    <assignField src="resolution" field="AdministrativeResolution" block="true"/>

                    <findLineContent dst="per" content="Tipo@de@Permanencia" threshold="0.2"/>
                    <assignIfValid dst="perma" src="per" offset="+1" overwrite="false"/>
                    <assignField src="perma" field="TypeOfStay"/>
                </ML>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="CR" iso="CRI">
        <Version id="v1" type="TD1" document_type="FOC" priority="PDF417,BARCODE,ML,MRZ,OCR,INPUT">
            <Front>
                <FACE/>
                <ML cols="2" split_by="elements" separation="0.08" space_separation="0.1">

                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rcr" content="REPUBLICA@DE@COSTA@RICA" threshold="0.2"/>
                    <findLineContent dst="cr" content="DE@COSTA@RICA" threshold="0.2"/>
                    <findLineContent dst="ddi" content="DOCUMENTO@DE@IDENTIDAD" threshold="0.2"/>
                    <findLineContent dst="mpe" content="MIGRATORIO@PARA@EXTRANJEROS" threshold="0.2"/>
                    <rejectIfNotValid2 src="rcr" src2="cr" reason="DocumentNotExpected"/>
                    <rejectIfNotValid2 src="ddi" src2="mpe" reason="DocumentNotExpected"/>

                    <findLineContent dst="apeStr" content="Apellidos:#" threshold="0.3"/>
                    <replaceIfValid dst="ln" src="apeStr" content="Apellidos" replace="" threshold="0.3"/>
                    <replaceIfValid dst="ln" content=":" replace=""/>
                    <rejectIfNotValid src="ln"/>
                    <assignField src="ln" field="LastName"/>

                    <findLineContent dst="nomStr" content="Nombre:#" threshold="0.3"/>
                    <replaceIfValid dst="fn" src="nomStr" content="Nombre" replace="" threshold="0.3"/>
                    <replaceIfValid dst="fn" content=":" replace=""/>
                    <rejectIfNotValid src="fn"/>
                    <assignField src="fn" field="FirstName"/>

                    <findLineContent dst="nacStr" content="Nacionalidad:#" threshold="0.3"/>
                    <replaceIfValid dst="nat" src="nacStr" content="Nacionalidad" replace="" threshold="0.3"/>
                    <replaceIfValid dst="nat" content=":" replace=""/>
                    <assignField src="nat" field="Nationality"/>

                    <findLineContent dst="docStr" content="Documento@No.:#" threshold="0.3"/>
                    <matchIfValid src="docStr" dst="doc"
                        regex="([0-9oOl]{10,})$"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <matchIfValid src="docStr" dst="doc"
                        regex="([0-9oOl]{10,}) "
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="doc" reason="DocumentNotExpected"/>
                    <assignField src="doc" field="DocumentNumber"/>

                    <!-- We check for Date of issue in the same line than the document number -->
                    <matchIfValid src="docStr" dst="doi"
                        regex="(?:[0-9oOl]{10,}) .*([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />

                    <findLineContent dst="expStr" content="Expediente@No.:#" threshold="0.3"/>
                    <matchIfValid src="expStr" dst="exp"
                        regex="([0-9oOl]{3}-?[0-9oOl]{6})$"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <assignField src="exp" field="FileNumber"/>

                    <findLineContent dst="sexStr" content="Sexo@@@" threshold="0.2"/>
                    <matchIfValid src="sexStr" dst="sex"
                        regex="([M|F])$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="sex" field="Gender"/>

                    <findLineMatch dst="dob"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="dob"/>
                    <assignField src="dob" field="DateOfBirth"/>

                    <jumpIfValid src="doi" dst="VALID_DOI"/>
                        <findLineMatch dst="doi"
                            regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                            value="($1)/($2)/($3)"
                        />
                    <label src="VALID_DOI"/>
                    <rejectIfNotValid src="doi"/>
                    <assignField src="doi" field="DateOfIssue"/>

                    <findLineMatch dst="doe"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doe"/>
                    <assignField src="doe" field="DateOfExpiry"/>
                </ML>
            </Front>

            <Back>
                <ML cols="2" split_by="lines" separation="0.1" space_separation="0.1">
                <!--
                    <findLineContent dst="res0" content="DOCUMENTO@DE@GOBIERNO@OFICIAL" threshold="0.3"/>
                    <findLineContent dst="res1" content="MANTENGASE@SIEMPRE@EN@SOBRE@ORIGINAL" threshold="0.3"/>
                    <findLineContent dst="res2" content="DOCUMENTO@DE@GOBIERNO@OFICIAL@@@MANTENGASE@SIEMPRE@EN@SOBRE@ORIGINAL" threshold="0.3"/>
                    <rejectIfNotValid3 src="res0" src2="res1" src3="res2" reason="DocumentNotExpected"/>
                -->
                </ML>

                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="CRI"/>
                    <field id="DocumentNumber"  line="1" starts="6" count="25"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="AE" iso="ARE">
        <Version id="PresetFc" type="TD1" document_type="FOC">
            <Back>
                <BLINKID>
                    <ML>
                        <field id="IDCardNumber" move="DocumentNumber"/>
                    </ML>
                    <MRZ>
                        <field id="IDCardNumber" move="DocumentNumber"/>
                        <field id="DocumentNumber" copy="Opt1"/>
                    </MRZ>
                </BLINKID>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="KR" iso="KOR">
        <Version id="ID" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML-KR cols="1" split_by="elements" separation="0.20" space_separation="0.15">
                    
                    <findLineContent dst="idStr" content="주민둥록증" threshold="2" overwrite="false"/>
                    <rejectIfNotValid src="idStr" reason="DocumentNotExpected"/>

                    <findLineMatchMultiple src="docNumStr"
                        regex="((?:[0-9OolI] ?){2})([0-1OolI] ?[0-9OolI]) ?([0-3OolI] ?[0-9OolI]) ?- ?([0-9OolI]) ?((?:[0-9OolI] ?){6})"
                        overwrite="false"
                        dst1="docNum"
                        value1="([N]$1)([N]$2)([N]$3)-([N]$4)([N]$5)"
                        dst2="DoB"
                        value2="([N]$3)/([N]$2)/([YP]$1)"
                        dst3="sexStr"
                        value3="([N]$4)"
                    />
                    <findLineMatchMultiple src="docNumStr"
                        regex="((?:[0-9OolI] ?){2})([0-1OolI] ?[0-9OolI]) ?([0-3OolI] ?[0-9OolI]) ?[^A-Za-z0-9]* ?([0-9OolI]) ?((?:[0-9OolI] ?){6})"
                        overwrite="false"
                        dst1="docNum"
                        value1="([N]$1)([N]$2)([N]$3)-([N]$4)([N]$5)"
                        dst2="DoB"
                        value2="([N]$3)/([N]$2)/([YP]$1)"
                        dst3="sexStr"
                        value3="([N]$4)"
                    />
                    <replaceIfValid dst="docNum" content=" " replace=""/>
                    <rejectIfNotValid src="docNum" reason="DocumentNotExpected"/>
                    <assignField src="docNum" field="DocumentNumber" mask="-6"/>

                    <replaceIfValid dst="DoB" content=" " replace=""/>
                    <assignField src="DoB" field="DateOfBirth"/>

                    <matchIfValid src="sexStr" dst="sex" regex="([02468])" value="F" overwrite="false"/>
                    <matchIfValid src="sexStr" dst="sex" regex="([13579])" value="M" overwrite="false"/>
                    <assignField src="sex" field="Gender"/>

                    <findLineMatch src="doiStr" dst="DoI"
                        regex="^([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1]?[0-9])(?: |[^A-Za-z0-9])*([0-3]?[0-9])"
                        value="($3)/($2)/($1)"
                    />
                    <matchIfValid dst="DoI" regex="^([0-9]{1})/([0-9]{2})/([0-9]{4})" value="0($1)/($2)/($3)"/>
                    <matchIfValid dst="DoI" regex="^([0-9]{2})/([0-9]{1})/([0-9]{4})" value="($1)/0($2)/($3)"/>
                    <matchIfValid dst="DoI" regex="^([0-9]{1})/([0-9]{1})/([0-9]{4})" value="0($1)/0($2)/($3)"/>
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue"/>

                    <assignIfValid dst="fullN" src="docNum" offset="-1" overwrite="false"/>
                    <assignIfValid dst="fullN" src="idStr" offset="+1" overwrite="false"/>
                    <matchIfValid src="fullN" dst="fullName"
                        regex="^([^ ]*) ?\(.*\)?"
                        value="($1)"
                        overwrite="false"
                    />
                    <matchIfValid src="fullN" dst="fullName"
                        regex="^(.{3})"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="fullName"/>
                    <assignField src="fullName" field="FullName"/>

                    <assignIfValid dst="address" src="docNum" offset="+1" overwrite="false"/>
                    <assignIfValid dst="address2" src="docNum" offset="+2" overwrite="false"/>
                    <assignIfValid dst="address3" src="docNum" offset="+3" overwrite="false"/>
                    <concatenateIfValid dst="address" src="address2" prefix=" " suffix=""/>
                    <concatenateIfValid dst="address" src="address3" prefix=" " suffix=""/>
                    <rejectIfNotValid src="address"/>
                    <assignField src="address" field="Address"/>

                    <matchIfValid src="address" dst="cityStr"
                        regex="([^ ]*)[시사]"
                        value="($1)시"
                    />
                    <assignFromList dst="city" src="cityStr" threshold="1"
                        list="서울특별시,부산광역시,대구광역시,인천광역시,광주광역시,대전광역시,울산광역시,세종특별자치시,수원시,성남시,의정부시,안양시,부천시,광명시,평택시,동두천시,안산시,고양시,과천시,구리시,남양주시,오산시,시흥시,군포시,의왕시,하남시,용인시,파주시,이천시,안성시,김포시,화성시,광주시,양주시,포천시,여주시,춘천시,원주시,강릉시,동해시,태백시,속초시,삼척시,청주시,충주시,제천시,천안시,공주시,보령시,아산시,서산시,논산시,계룡시,당진시,전주시,군산시,익산시,정읍시,남원시,김제시,목포시,여수시,순천시,나주시,광양시,포항시,경주시,김천시,안동시,구미시,영주시,영천시,상주시,문경시,경산시,창원시,진주시,통영시,사천시,김해시,밀양시,거제시,양산시,제주시,서귀포시"
                    />
                    <assignField src="city" field="City"/>

                    <matchIfValid src="address" dst="districtStr"
                        regex="([^ ]*)[구쿠꾸]"
                        value="($1)구"
                    />
                    <assignFromList dst="district" src="districtStr" threshold="1"
                        list="장안구,권선구,팔달구,영통구,수정구,중원구,분당구,만안구,동안구,상록구,단원구,덕양구,일산동구,일산서구,처인구,기흥구,수지구,상당구,서원구,흥덕구,청원구,동남구,서북구,완산구,덕진구,남구,북구,의창구,성산구,마산합포구,마산회원구,진해구,종로구,중구,용산구,성동구,광진구,동대문구,중랑구,성북구,강북구,도봉구,노원구,은평구,서대문구,마포구,양천구,강서구,구로구,금천구,영등포구,동작구,관악구,서초구,강남구,송파구,강동구,서구,동구,영도구,부산진구,동래구,해운대구,사하구,금정구,연제구,수영구,사상구,수성구,달서구,미추홀구,연수구,남동구,부평구,계양구,광산구,유성구,대덕구"
                    />
                    <assignField src="district" field="District"/>

                    <matchIfValid src="address" dst="townStr"
                        regex="([^ ]*)[군쿤꾼]"
                        value="($1)군"
                    />
                    <assignFromList dst="town" src="townStr" threshold="1"
                        list="연천군,가평군,양평군,홍천군,횡성군,영월군,평창군,정선군,철원군,화천군,양구군,인제군,고성군,양양군,보은군,옥천군,영동군,증평군,진천군,괴산군,음성군,단양군,금산군,부여군,서천군,청양군,홍성군,예산군,태안군,완주군,진안군,무주군,장수군,임실군,순창군,고창군,부안군,담양군,곡성군,구례군,고흥군,보성군,화순군,장흥군,강진군,해남군,영암군,무안군,함평군,영광군,장성군,완도군,진도군,신안군,군위군,의성군,청송군,영양군,영덕군,청도군,고령군,성주군,칠곡군,예천군,봉화군,울진군,울릉군,의령군,함안군,창녕군,남해군,하동군,산청군,함양군,거창군,합천군,달성군,강화군,옹진군,울주군,기장군"
                    />
                    <assignField src="town" field="Town"/>

                    <matchIfValid src="address" dst="provinceStr"
                        regex="([^ ]*)[도됴툐]"
                        value="($1)도"
                    />
                    <assignFromList dst="province" src="provinceStr" threshold="1"
                        list="경기도,강원도,충청북도,충청남도,전라북도,전라남도,경상북도,경상남도,제주특별자치도"
                    />
                    <assignField src="province" field="Province"/>

                    <replaceIfValid dst="address" content="$cityStr" replace="$city"/>
                    <replaceIfValid dst="address" content="$districtStr" replace="$district"/>
                    <replaceIfValid dst="address" content="$townStr" replace="$town"/>
                    <replaceIfValid dst="address" content="$provinceStr" replace="$province"/>

                </ML-KR>

            </Front>
        </Version>

        <Version id="DL" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML-KR cols="5" split_by="elements" separation="0.10" space_separation="0.10">
                    
                    <postProcessImage dst=""
                        rMin="0.000" rMax="0.999"
                        gMin="0.000" gMax="0.999"
                        bMin="0.000" bMax="0.750"
                        rWeight="0.000"
                        gWeight="0.000"
                        bWeight="0.999"
                    />

                    <findLineContent dst="dlStr" content="자동차운전면허증#" threshold="3" overwrite="false"/>
                    <rejectIfNotValid src="dlStr" reason="DocumentNotExpected"/>

                    <findLineMatch src="dlNumStr" dst="dlNum"
                        regex="([0-9OolI]{2})-([0-9OolI]{2})-([0-9OolI]{6})-([0-9OolI]{2})"
                        value="([N]$1)-([N]$2)-([N]$3)-([N]$4)"
                        overwrite="false"
                    />
                    <findLineMatch src="dlNumStr" dst="dlNum"
                        regex="([0-9OolI]{2})(?: |[^A-Za-z0-9])*([0-9OolI]{2})(?: |[^A-Za-z0-9])*([0-9OolI]{6})(?: |[^A-Za-z0-9])*([0-9OolI]{2})"
                        value="([N]$1)-([N]$2)-([N]$3)-([N]$4)"
                        overwrite="false"
                    />
                    <findLineMatch src="dlNumStr" dst="dlNum"
                        regex="([^ ]+) ?([0-9OolI]{2})-([0-9OolI]{6})-([0-9OolI]{2})"
                        value="($1) ([N]$2)-([N]$3)-([N]$4)"
                        overwrite="false"
                    />
                    <findLineMatch src="dlNumStr" dst="dlNum"
                        regex="([^ ]+) ?([0-9OolI]{2})(?: |[^A-Za-z0-9])*([0-9OolI]{6})(?: |[^A-Za-z0-9])*([0-9OolI]{2})"
                        value="($1) ([N]$2)-([N]$3)-([N]$4)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="dlNum" reason="DocumentNotExpected"/>
                    <assignField src="dlNum" field="DriverLicenseNumber" mask="-4"/>

                    <findLineMatchMultiple src="docNumStr"
                        regex="((?:[0-9OolI] ?){2})([0-1OolI] ?[0-9OolI]) ?([0-3OolI] ?[0-9OolI]) ?- ?([0-9OolI]) ?((?:[0-9OolI] ?){6})"
                        overwrite="false"
                        dst1="docNum"
                        value1="([N]$1)([N]$2)([N]$3)-([N]$4)([N]$5)"
                        dst2="DoB"
                        value2="([N]$3)/([N]$2)/([YP]$1)"
                        dst3="sexStr"
                        value3="([N]$4)"
                    />
                    <findLineMatchMultiple src="docNumStr"
                        regex="((?:[0-9OolI] ?){2})([0-1OolI] ?[0-9OolI]) ?([0-3OolI] ?[0-9OolI]) ?[^A-Za-z0-9]* ?([0-9OolI]) ?((?:[0-9OolI] ?){6})"
                        overwrite="false"
                        dst1="docNum"
                        value1="([N]$1)([N]$2)([N]$3)-([N]$4)([N]$5)"
                        dst2="DoB"
                        value2="([N]$3)/([N]$2)/([YP]$1)"
                        dst3="sexStr"
                        value3="([N]$4)"
                    />
                    <replaceIfValid dst="docNum" content=" " replace=""/>
                    <replaceIfValid dst="DoB" content=" " replace=""/>
                    <rejectIfNotValid src="docNum" reason="DocumentNotExpected"/>
                    <assignField src="docNum" field="DocumentNumber" mask="-6"/>

                    <matchIfValid src="sexStr" dst="sex" regex="([02468])" value="F" overwrite="false"/>
                    <matchIfValid src="sexStr" dst="sex" regex="([13579])" value="M" overwrite="false"/>
                    <assignField src="sex" field="Gender"/>

                    <assignIfValid dst="fullN" src="docNum" offset="-1" overwrite="false"/>
                    <assignIfValid dst="fullN" src="dlNum" offset="+1" overwrite="false"/>
                    <findLineInside dst="fullN" overwrite="false"
                        x="0.350" y="0.245" w="0.650" h="0.130"
                    />
                    <rejectIfNotValid src="fullN"/>
                    <matchIfValid src="fullN" dst="fullN"
                        regex="(.{3})[,.:;-A-Za-z0-9]*$"
                        value="($1)"
                    />
                    <assignField src="fullN" field="FullName"/>

                    <findLineMatch src="dorStr" dst="DoR" overwrite="false"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1]?[0-9])(?: |[^A-Za-z0-9])*([0-3]?[0-9]).?$"
                        value="($3)/($2)/($1)"
                    />
                    <matchIfValid dst="DoR" regex="^([0-9]{1})/([0-9]{2})/([0-9]{4})" value="0($1)/($2)/($3)"/>
                    <matchIfValid dst="DoR" regex="^([0-9]{2})/([0-9]{1})/([0-9]{4})" value="($1)/0($2)/($3)"/>
                    <matchIfValid dst="DoR" regex="^([0-9]{1})/([0-9]{1})/([0-9]{4})" value="0($1)/0($2)/($3)"/>
                    <rejectIfNotValid src="DoR"/>
                    <assignField src="DoR" field="DateOfRenewal"/>

                    <findLineMatch src="doeStr" dst="DoE"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1]?[0-9])(?: |[^A-Za-z0-9])*([0-3]?[0-9]).?$"
                        value="($3)/($2)/($1)"
                    />
                    <matchIfValid dst="DoE" regex="^([0-9]{1})/([0-9]{2})/([0-9]{4})" value="0($1)/($2)/($3)"/>
                    <matchIfValid dst="DoE" regex="^([0-9]{2})/([0-9]{1})/([0-9]{4})" value="($1)/0($2)/($3)"/>
                    <matchIfValid dst="DoE" regex="^([0-9]{1})/([0-9]{1})/([0-9]{4})" value="0($1)/0($2)/($3)"/>
                    <rejectIfNotValid src="DoE"/>
                    <assignField src="DoE" field="DateOfExpiry"/>

                    <findLineMatch src="doiStr" dst="DoI"
                        regex="^([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1]?[0-9])(?: |[^A-Za-z0-9])*([0-3]?[0-9])"
                        value="($3)/($2)/($1)"
                    />
                    <matchIfValid dst="DoI" regex="^([0-9]{1})/([0-9]{2})/([0-9]{4})" value="0($1)/($2)/($3)"/>
                    <matchIfValid dst="DoI" regex="^([0-9]{2})/([0-9]{1})/([0-9]{4})" value="($1)/0($2)/($3)"/>
                    <matchIfValid dst="DoI" regex="^([0-9]{1})/([0-9]{1})/([0-9]{4})" value="0($1)/0($2)/($3)"/>
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue"/>

                    <assignIfValid dst="address" src="docNum" offset="+1" overwrite="false"/>
                    <assignIfValid dst="address2" src="docNum" offset="+2" overwrite="false"/>
                    <assignIfValid dst="address3" src="docNum" offset="+3" overwrite="false"/>
                    <assignIfValid dst="address" src="DoR" offset="-3" overwrite="false"/>
                    <assignIfValid dst="address2" src="DoR" offset="-2" overwrite="false"/>
                    <assignIfValid dst="address3" src="DoR" offset="-1" overwrite="false"/>
                    <concatenateIfValid dst="address" src="address2" prefix=" " suffix=""/>
                    <concatenateIfValid dst="address" src="address3" prefix=" " suffix=""/>
                    <assignField src="address" field="Address"/>

                    <matchIfValid src="address" dst="cityStr"
                        regex="([^ ]*)[시사]"
                        value="($1)시"
                    />
                    <assignFromList dst="city" src="cityStr" threshold="1"
                        list="서울특별시,부산광역시,대구광역시,인천광역시,광주광역시,대전광역시,울산광역시,세종특별자치시,수원시,성남시,의정부시,안양시,부천시,광명시,평택시,동두천시,안산시,고양시,과천시,구리시,남양주시,오산시,시흥시,군포시,의왕시,하남시,용인시,파주시,이천시,안성시,김포시,화성시,광주시,양주시,포천시,여주시,춘천시,원주시,강릉시,동해시,태백시,속초시,삼척시,청주시,충주시,제천시,천안시,공주시,보령시,아산시,서산시,논산시,계룡시,당진시,전주시,군산시,익산시,정읍시,남원시,김제시,목포시,여수시,순천시,나주시,광양시,포항시,경주시,김천시,안동시,구미시,영주시,영천시,상주시,문경시,경산시,창원시,진주시,통영시,사천시,김해시,밀양시,거제시,양산시,제주시,서귀포시"
                    />
                    <assignField src="city" field="City"/>

                    <matchIfValid src="address" dst="districtStr"
                        regex="([^ ]*)[구쿠꾸]"
                        value="($1)구"
                    />
                    <assignFromList dst="district" src="districtStr" threshold="1"
                        list="장안구,권선구,팔달구,영통구,수정구,중원구,분당구,만안구,동안구,상록구,단원구,덕양구,일산동구,일산서구,처인구,기흥구,수지구,상당구,서원구,흥덕구,청원구,동남구,서북구,완산구,덕진구,남구,북구,의창구,성산구,마산합포구,마산회원구,진해구,종로구,중구,용산구,성동구,광진구,동대문구,중랑구,성북구,강북구,도봉구,노원구,은평구,서대문구,마포구,양천구,강서구,구로구,금천구,영등포구,동작구,관악구,서초구,강남구,송파구,강동구,서구,동구,영도구,부산진구,동래구,해운대구,사하구,금정구,연제구,수영구,사상구,수성구,달서구,미추홀구,연수구,남동구,부평구,계양구,광산구,유성구,대덕구"
                    />
                    <assignField src="district" field="District"/>

                    <matchIfValid src="address" dst="townStr"
                        regex="([^ ]*)[군쿤꾼]"
                        value="($1)군"
                    />
                    <assignFromList dst="town" src="townStr" threshold="1"
                        list="연천군,가평군,양평군,홍천군,횡성군,영월군,평창군,정선군,철원군,화천군,양구군,인제군,고성군,양양군,보은군,옥천군,영동군,증평군,진천군,괴산군,음성군,단양군,금산군,부여군,서천군,청양군,홍성군,예산군,태안군,완주군,진안군,무주군,장수군,임실군,순창군,고창군,부안군,담양군,곡성군,구례군,고흥군,보성군,화순군,장흥군,강진군,해남군,영암군,무안군,함평군,영광군,장성군,완도군,진도군,신안군,군위군,의성군,청송군,영양군,영덕군,청도군,고령군,성주군,칠곡군,예천군,봉화군,울진군,울릉군,의령군,함안군,창녕군,남해군,하동군,산청군,함양군,거창군,합천군,달성군,강화군,옹진군,울주군,기장군"
                    />
                    <assignField src="town" field="Town"/>

                    <matchIfValid src="address" dst="provinceStr"
                        regex="([^ ]*)[도됴툐]"
                        value="($1)도"
                    />
                    <assignFromList dst="province" src="provinceStr" threshold="1"
                        list="경기도,강원도,충청북도,충청남도,전라북도,전라남도,경상북도,경상남도,제주특별자치도"
                    />
                    <assignField src="province" field="Province"/>

                    <replaceIfValid dst="address" content="$cityStr" replace="$city"/>
                    <replaceIfValid dst="address" content="$districtStr" replace="$district"/>
                    <replaceIfValid dst="address" content="$townStr" replace="$town"/>
                    <replaceIfValid dst="address" content="$provinceStr" replace="$province"/>

                </ML-KR>

            </Front>
        </Version>

        <Version id="FC" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML-KR cols="1" split_by="elements" separation="0.20" space_separation="0.15">
                    
                    <findLineContent dst="idStrKor" content="외국인등록증" threshold="2" overwrite="false"/>
                    <findLineContent dst="idStrKor" content="영주증" threshold="1" overwrite="false"/>
                    <rejectIfNotValid src="idStrKor" reason="DocumentNotExpected"/>
                    <findLineContent dst="idStr" content="ALIEN@REGISTRATION@CARD" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="idStr" content="PERMANENT@RESIDENT@CARD" threshold="0.3" overwrite="false"/>
                    <rejectIfNotValid src="idStr" reason="DocumentNotExpected"/>

                    <findLineMatchMultiple src="docNumStr"
                        regex="((?:[0-9OolI] ?){2})([0-1OolI] ?[0-9OolI]) ?([0-3OolI] ?[0-9OolI]) ?- ?([0-9OolI]) ?((?:[0-9OolI] ?){6})"
                        overwrite="false"
                        dst1="docNum"
                        value1="([N]$1)([N]$2)([N]$3)-([N]$4)([N]$5)"
                        dst2="DoB"
                        value2="([N]$3)/([N]$2)/([YP]$1)"
                        dst3="sexStr"
                        value3="([N]$4)"
                    />
                    <findLineMatchMultiple src="docNumStr"
                        regex="((?:[0-9OolI] ?){2})([0-1OolI] ?[0-9OolI]) ?([0-3OolI] ?[0-9OolI]) ?[^A-Za-z0-9]* ?([0-9OolI]) ?((?:[0-9OolI] ?){6})"
                        overwrite="false"
                        dst1="docNum"
                        value1="([N]$1)([N]$2)([N]$3)-([N]$4)([N]$5)"
                        dst2="DoB"
                        value2="([N]$3)/([N]$2)/([YP]$1)"
                        dst3="sexStr"
                        value3="([N]$4)"
                    />
                    <replaceIfValid dst="docNum" content=" " replace=""/>
                    <rejectIfNotValid src="docNum" reason="DocumentNotExpected"/>
                    <assignField src="docNum" field="DocumentNumber" mask="-6"/>

                    <replaceIfValid dst="DoB" content=" " replace=""/>
                    <assignField src="DoB" field="DateOfBirth"/>

                    <matchIfValid src="sexStr" dst="sex" regex="([02468])" value="F" overwrite="false"/>
                    <matchIfValid src="sexStr" dst="sex" regex="([13579])" value="M" overwrite="false"/>
                    <assignField src="sex" field="Gender"/>

                    <findLineMatch src="doiStr" dst="DoI"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1]?[0-9])(?: |[^A-Za-z0-9])*([0-3]?[0-9])"
                        value="($3)/($2)/($1)"
                    />
                    <matchIfValid dst="DoI" regex="^([0-9]{1})/([0-9]{2})/([0-9]{4})" value="0($1)/($2)/($3)"/>
                    <matchIfValid dst="DoI" regex="^([0-9]{2})/([0-9]{1})/([0-9]{4})" value="($1)/0($2)/($3)"/>
                    <matchIfValid dst="DoI" regex="^([0-9]{1})/([0-9]{1})/([0-9]{4})" value="0($1)/0($2)/($3)"/>
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue"/>

                    <assignIfValid dst="fullN" src="doiStr" offset="-3" overwrite="false"/>
                    <matchIfValid src="fullN" dst="fullName"
                        regex="성 ?명 ?([A-Z \.,]+)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <matchIfValid src="fullN" dst="fullName"
                        regex="([A-Z \.,]+)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="fullName"/>
                    <assignField src="fullName" field="FullName"/>

                    <assignIfValid dst="natStr" src="doiStr" offset="-2" overwrite="false"/>
                    <matchIfValid src="natStr" dst="nat"
                        regex="([A-Z \.,]+)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="nat"/>
                    <assignField src="nat" field="Nationality"/>

                </ML-KR>

            </Front>
        </Version>
    </DocumentID>

    <DocumentID id="CO" iso="COL">
        <Version id="PPT" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="5" split_by="elements" separation="0.05" space_separation="0.1">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rdc" content="REPÚBLICA@DE@COLOMBIA" threshold="0.3"/>
                    <findLineContent dst="ppt" content="PERMISO@POR@PROTECCIÓN@TEMPORAL" threshold="0.3"/>
                    <rejectIfNotValid src="rdc" reason="DocumentNotExpected"/>
                    <rejectIfNotValid src="ppt" reason="DocumentNotExpected"/>

                    <findLineMatch dst="docNumber"
                        regex="([0-9OolI]{7})$"
                        value="([N]$1)"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineContent dst="ape" content="APELLIDOS" threshold="0.3"/>
                    <findLineContent dst="nom" content="NOMBRES" threshold="0.3"/>
                    <findLineContent dst="dni" content="DNI@Nro@" threshold="0.3"/>
                    <findLineContent dst="nac" content="NACIONALIDAD" threshold="0.3"/>
                    <findLineContent dst="sex" content="SEXO" threshold="0.3"/>
                    <findLineContent dst="bir" content="FECHA@DE@NACIMIENTO" threshold="0.3"/>
                    <findLineContent dst="fle" content="FECHA@Y@LUGAR@DE@EXPEDICION" threshold="0.3"/>
                    <findLineContent dst="exp" content="FECHA@DE@VENCIMIENTO" threshold="0.3"/>

                    <rejectIfNotValid src="ape"/>
                    <rejectIfNotValid src="nom"/>

                    <assignIfValid dst="ln" src="ape" offset="-1" overwrite="false"/>
                    <assignField src="ln" field="LastName"/>

                    <assignIfValid dst="fn" src="nom" offset="-1" overwrite="false"/>
                    <assignField src="fn" field="FirstName"/>

                    <assignIfValid dst="fullN" src="fn"/>
                    <concatenateIfValid dst="fullN" src="ln" prefix=" " suffix=""/>
                    <assignField src="fullN" field="FullName"/>

                    <assignIfValid dst="idNumberStr" src="dni" offset="-1" overwrite="false"/>
                    <replaceIfValid dst="idNumberStr" content=" " replace=""/>
                    <matchIfValid src="idNumberStr" dst="idNumber"
                        regex="^([0-9OolI]{8,})$"
                        value="([N]$1)"
                    />
                    <assignField src="idNumber" field="IDNumber"/>

                    <assignIfValid dst="nacionalidad" src="nac" offset="-1" overwrite="false"/>
                    <assignField src="nacionalidad" field="Nationality"/>

                    <findLineMatch dst="sexo"
                        regex="^([M|F])$"
                        value="($1)"
                    />
                    <assignField src="sexo" field="Gender"/>

                    <findLineMatch dst="DoB"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="DoB"/>
                    <assignField src="DoB" field="DateOfBirth"/>

                    <findLineMatch dst="DoI"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue"/>

                    <findLineMatch dst="DoE"
                        regex="^([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})$"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="DoE"/>
                    <assignField src="DoE" field="DateOfExpiry"/>
                </ML>
            </Front>
            <Back>
                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="COL"/>
                    <field id="DocumentNumber"  line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>

                <BARCODE types="QRCODE" decode="splitBy:," charset="UTF-8" optional="yes">
                    <field id="FirstName"       data="0"/>
                    <field id="LastName"        data="1"/>
                    <field id="DateOfBirth"     data="2"/>
                    <field id="Nationality"     data="3"/>
                    <field id="DocumentNumber"  data="4"/>
                </BARCODE>

                <ML cols="5" split_by="elements" separation="0.05" space_separation="0.1">
                    <findLineContent dst="mrk1" content="El@titular@de@este@documento@debe@notificar@a@Migración@Colombia" threshold="0.3"/>
                    <findLineContent dst="mrk2" content="cualquier@cambio@en@la@condición@o@información@migratoria" threshold="0.3"/>
                    <findLineContent dst="mig" content="MIGRACIÓN" threshold="0.3"/>
                    <findLineContent dst="mre" content="MINISTERIO@DE@RELACIONES@EXTERIORES" threshold="0.3"/>
                    <findLineContent dst="www" content="www@migracioncolombia@gov@co" threshold="0.3"/>
                    <rejectIfNotValid src="mig"/>
                    <rejectIfNotValid4 src="mrk1" src2="mrk2" src3="mre" src4="www"/>
                </ML>

            </Back>
        </Version>

        <Version id="Extranjeria" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="5" split_by="elements" separation="0.05" space_separation="0.1">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rdc" content="REPÚBLICA@DE@COLOMBIA" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="cde" content="CÉDULA@DE@EXTRANJERÍA" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="cde" content="Cédula@de@Extranjería" threshold="0.3" overwrite="false"/>
                    <rejectIfNotValid src="rdc" reason="DocumentNotExpected"/>
                    <rejectIfNotValid src="cde" reason="DocumentNotExpected"/>

                    <findLineMatch dst="docNumber"
                        regex="([0-9OolI]{6,9})$"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="docNumber"
                        regex="([0-9OolI]{6,9}) "
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineContent dst="ape" content="APELLIDOS#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="nom" content="NOMBRES#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="nac" content="NACIONALIDAD#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="sex" content="SEXO#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="rh" content="RH#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="bir" content="FECHA@DE@NACIMIENTO#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="fle" content="F@@EXPEDICIÓN#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="fle" content="F@EXPEDICIÓN#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="fle" content="FEXPEDICIÓN#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="exp" content="VENCE#" threshold="0.3" overwrite="false"/>

                    <rejectIfNotValid src="ape"/>
                    <rejectIfNotValid src="nom"/>

                    <matchIfValid src="ape" dst="ln" regex=".*: ?(.*)" value="($1)" overwrite="false"/>
                    <matchIfValid src="ape" dst="ln" regex="^[^ ]+ (.+)" value="($1)" overwrite="false"/>
                    <assignIfValid dst="ln" src="ape" offset="+1" overwrite="false"/>
                    <rejectIfNotValid src="ln"/>
                    <assignField src="ln" field="LastName"/>

                    <matchIfValid src="nom" dst="fn" regex=".*: ?(.*)" value="($1)" overwrite="false"/>
                    <matchIfValid src="nom" dst="fn" regex="^[^ ]+ (.+)" value="($1)" overwrite="false"/>
                    <assignIfValid dst="fn" src="nom" offset="+1" overwrite="false"/>
                    <rejectIfNotValid src="fn"/>
                    <assignField src="fn" field="FirstName"/>

                    <assignIfValid dst="fullN" src="fn"/>
                    <concatenateIfValid dst="fullN" src="ln" prefix=" " suffix=""/>
                    <assignField src="fullN" field="FullName"/>

                    <matchIfValid src="nac" dst="nacionalidad" regex=".*: ?(.*)" value="($1)" overwrite="false"/>
                    <matchIfValid src="nac" dst="nacionalidad" regex="^[^ ]+ (.+)" value="($1)" overwrite="false"/>
                    <assignIfValid dst="nacionalidad" src="nac" offset="+1" overwrite="false"/>
                    <assignField src="nacionalidad" field="Nationality"/>

                    <matchIfValid src="sex" dst="sexo" regex=".*: ?([M|F])" value="($1)" overwrite="false"/>
                    <matchIfValid src="sex" dst="sexo" regex="^[^ ]+ ([M|F])" value="($1)" overwrite="false"/>
                    <findLineMatch dst="sexo"
                        regex="^([M|F])$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="sexo" field="Gender"/>

                    <matchIfValid src="rh" dst="bt"
                        regex="(A|B|8|0|O|o|AB|A8) ?(\+|\-)$"
                        value="([U]$1)($2)"
                        overwrite="false"
                    />
                    <findLineMatch dst="bt"
                        regex="^(A|B|8|0|O|o|AB|A8) ?(\+|\-)$"
                        value="([U]$1)($2)"
                        overwrite="false"
                    />
                    <assignField src="bt" field="BloodType"/>

                    <matchIfValid src="bir" dst="DoB"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([0-3][0-9])$"
                        value="($3)/($2)/($1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoB"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([0-3][0-9])$"
                        value="($3)/($2)/($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoB"/>
                    <assignField src="DoB" field="DateOfBirth"/>

                    <matchIfValid src="fle" dst="DoI"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([0-3][0-9])$"
                        value="($3)/($2)/($1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoI"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([0-3][0-9])$"
                        value="($3)/($2)/($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue"/>

                    <matchIfValid src="exp" dst="DoE"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([0-3][0-9])$"
                        value="($3)/($2)/($1)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoE"
                        regex="([1-2][0-9]{3})(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([0-3][0-9])$"
                        value="($3)/($2)/($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoE"/>
                    <assignField src="DoE" field="DateOfExpiry"/>
                </ML>
            </Front>
            <Back>
                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="COL"/>
                    <field id="DocumentNumber"  line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>

                <PDF417 optional="yes">
                </PDF417>

                <ML cols="5" split_by="elements" separation="0.05" space_separation="0.1">
                    <findLineContent dst="mrk1" content="El@titular@de@este@documento@debe@notificar@a@MIGRACIÓN@COLOMBIA@cualquier@cambio" threshold="0.3"/>
                    <findLineContent dst="mrk2" content="en@la@condición@o@información@migratoria" threshold="0.3"/>
                    <findLineContent dst="www" content="www@migracioncolombia@gov@co" threshold="0.3"/>
                    <rejectIfNotValid3 src="mrk1" src2="mrk2" src3="www"/>
                </ML>

            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="SV" iso="SLV">
        <Version id="RD" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="lines" separation="0.04" space_separation="0.10">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rds" content="República@de@El@Salvador#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="rd" content="RESIDENCIA@DEFINITIVA" threshold="0.2" overwrite="false"/>
                    <rejectIfNotValid src="rds" reason="DocumentNotExpected"/>
                    <rejectIfNotValid src="rd" reason="DocumentNotExpected"/>

                    <findLineContent dst="num" content="Id@Migratorio#" threshold="0.2" overwrite="false"/>
                    <assignIfValid dst="docNumStr" src="num" offset="+1" overwrite="false"/>
                    <matchIfValid dst="docNum" src="docNumStr"
                        regex="([0-9oOl]{4,})"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNum"/>
                    <assignField src="docNum" field="DocumentNumber" block="true"/>
                    
                    <findLineContent dst="nom" content="Nombres#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="ape" content="Apellidos#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="sex" content="Sexo#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="nac" content="Nacionalidad#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="dob" content="Fecha@de@Nacimiento#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="doe" content="Fecha@de@Vencimiento#" threshold="0.3" overwrite="false"/>

                    <assignIfValid dst="fn" src="nom" offset="+1" overwrite="false"/>
                    <assignIfValid dst="ln" src="ape" offset="+1" overwrite="false"/>
                    <rejectIfNotValid src="fn"/>
                    <rejectIfNotValid src="ln"/>
                    <assignField src="fn" field="FirstName"/>
                    <assignField src="ln" field="LastName"/>

                    <findLineMatch dst="gender"
                        regex="^(M|F)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="gender" field="Gender"/>
                    
                    <assignIfValid dst="DoBStr" src="nac" offset="+1"/>
                    <matchIfValid dst="DoB" src="DoBStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoB" src="DoBStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoB"/>
                    <assignField src="DoB" field="DateOfBirth" block="true"/>

                    <assignIfValid dst="DoEStr" src="doe"/>
                    <matchIfValid dst="DoE" src="DoEStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoE" src="DoEStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoE"/>
                    <assignField src="DoE" field="DateOfExpiry" block="true"/>

                    <findLineContent dst="pnc" content="Pais@de@Nacimiento#" threshold="0.2" overwrite="false"/>
                    <assignIfValid dst="pob" src="pnc" offset="+1" overwrite="false"/>
                    <!-- <rejectIfNotValid src="pob"/> -->
                    <assignField src="pob" field="PlaceOfBirth" block="true"/>

                </ML>
            </Front>
            <Back>
                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="SLV"/>
                    <field id="DocumentNumber"  line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>
                <BARCODE optional="yes">
                </BARCODE>
                <ML cols="2" split_by="lines" separation="0.04" space_separation="0.10">

                    <findLineContent dst="rds" content="República@de@El@Salvador#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="rd" content="ESTE@DOCUMENTO@AUTORIZA@SALIR@Y@ENTRAR@AL@PAIS" threshold="0.2" overwrite="false"/>
                    <rejectIfNotValid src="rds" reason="DocumentNotExpected"/>

                    <findLineContent dst="nPass" content="No@@DE@PASAPORTE#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="doi" content="EXPEDICION#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="doe" content="VENCIMIENTO#" threshold="0.3" overwrite="false"/>

                    <assignIfValid dst="pnStr" src="nPass" offset="+1"/>
                    <matchIfValid dst="pass" src="pnStr"
                        regex="(.*[0-9]{5,}.*)"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="pass"/>
                    <assignField src="pass" field="PassportNumber" block="true"/>

                    <assignIfValid dst="DoIStr" src="doi" offset="+1"/>
                    <matchIfValid dst="DoI" src="DoIStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoI" src="DoIStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue" block="true"/>

                    <assignIfValid dst="DoEStr" src="doe" offset="+1"/>
                    <matchIfValid dst="DoE" src="DoEStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoE" src="DoEStr"
                        regex="([0-9]{2})(?: |1|\/|-|\.)*([0-9]{2})(?: |1|\/|-|\.)*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoE"/>
                    <assignField src="DoE" field="DateOfExpiry" block="true"/>

                </ML>
            </Back>
        </Version>

        <Version id="CR" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="7" split_by="elements" separation="0.04" space_separation="0.10">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rds" content="REPÚBLICA@DE@EL@SALVADOR" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="cr" content="Carné@de@Residencia" threshold="0.2" overwrite="false"/>
                    <rejectIfNotValid src="rds" reason="DocumentNotExpected"/>
                    <rejectIfNotValid src="cr" reason="DocumentNotExpected"/>

                    <findLineContent dst="num" content="No@@de@Identificacion@Migratorio#" threshold="0.2" overwrite="false"/>
                    <assignIfValid dst="docNumStr" src="num" offset="+1" overwrite="false"/>
                    <matchIfValid dst="docNum" src="docNumStr"
                        regex="([0-9oOl]{4,})"
                        value="([N]$1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNum"/>
                    <assignField src="docNum" field="DocumentNumber" block="true"/>
                    
                    <findLineContent dst="nom" content="Nombres#" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="ape" content="Apellidos#" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="sex" content="Sexo#" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="nac" content="Nacionalidad#" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="dob" content="Fecha@de@Nacimiento#" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="doinsc" content="Fecha@de@Inscripción#" threshold="0.2" overwrite="false"/>
                    <findLineContent dst="doe" content="Fecha@de@Vencimiento#" threshold="0.2" overwrite="false"/>

                    <assignIfValid dst="fn" src="nom" offset="+1" overwrite="false"/>
                    <assignIfValid dst="ln" src="ape" offset="+1" overwrite="false"/>
                    <rejectIfNotValid src="fn"/>
                    <rejectIfNotValid src="ln"/>
                    <assignField src="fn" field="FirstName"/>
                    <assignField src="ln" field="LastName"/>

                    <findLineMatch dst="gender"
                        regex="^(M|F)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <assignField src="gender" field="Gender"/>
                    
                    <assignIfValid dst="DoBStr" src="nac" offset="+1"/>
                    <matchIfValid dst="DoB" src="DoBStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoB" src="DoBStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoB"/>
                    <assignField src="DoB" field="DateOfBirth" block="true"/>

                    <assignIfValid dst="DoInsStr" src="doinsc" offset="+1"/>
                    <matchIfValid dst="DoIns" src="DoInsStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoIns" src="DoInsStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoIns"/>
                    <assignField src="DoIns" field="DateOfIssue" block="true"/>

                    <assignIfValid dst="DoEStr" src="doe"/>
                    <matchIfValid dst="DoE" src="DoEStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoE" src="DoEStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <!-- <rejectIfNotValid src="DoE"/> -->
                    <assignField src="DoE" field="DateOfExpiry" block="true"/>

                    <findLineContent dst="pnc" content="Pais@de@Nacimiento#" threshold="0.2" overwrite="false"/>
                    <assignIfValid dst="pob" src="pnc" offset="+1" overwrite="false"/>
                    <!-- <rejectIfNotValid src="pob"/> -->
                    <assignField src="pob" field="PlaceOfBirth" block="true"/>

                </ML>
            </Front>
            <Back>
                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="SLV"/>
                    <field id="DocumentNumber"  line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
                <PDF417 optional="yes">
                </PDF417>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>
                <ML cols="2" split_by="lines" separation="0.04" space_separation="0.10">

                    <findLineContent dst="rds" content="REPÚBLICA@DE@EL@SALVADOR#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="rd" content="ESTE@DOCUMENTO@AUTORIZA@SALIR@Y@REINGRESAR@AL@PAIS" threshold="0.2" overwrite="false"/>
                    <rejectIfNotValid src="rds" reason="DocumentNotExpected"/>

                    <findLineContent dst="nPass" content="No@@DE@PASAPORTE#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="doi" content="EXPEDICION#" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="doe" content="VENCE#" threshold="0.3" overwrite="false"/>

                    <assignIfValid dst="pnStr" src="nPass" offset="-1"/>
                    <matchIfValid dst="pass" src="pnStr"
                        regex="(.*[0-9]{5,}.*)"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="pass"/>
                    <assignField src="pass" field="PassportNumber" block="true"/>

                    <assignIfValid dst="DoIStr" src="doi" offset="+1"/>
                    <matchIfValid dst="DoI" src="DoIStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoI" src="DoIStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoI"/>
                    <assignField src="DoI" field="DateOfIssue" block="true"/>

                    <assignIfValid dst="DoEStr" src="doe" offset="+1"/>
                    <matchIfValid dst="DoE" src="DoEStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <findLineMatch dst="DoE" src="DoEStr"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*(0[1-9]|1[0-2])(?: |[^A-Za-z0-9])*(1[8-9][0-9]{2}|2[0-4][0-9]{2})"
                        value="($1)/($2)/($3)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="DoE"/>
                    <assignField src="DoE" field="DateOfExpiry" block="true"/>

                </ML>
            </Back>
        </Version>
    </DocumentID>

    <DocumentID id="BR" iso="BRA">
        <Version id="RNE" type="TD1" document_type="FOC">
            <Front>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>
                <ML cols="5" split_by="lines" separation="0.04" space_separation="0.10">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rfdb" content="REPÚBLICA@FEDERATIVA@DO@BRASIL" threshold="0.3" overwrite="false"/>
                    <rejectIfNotValid src="rfdb" reason="DocumentNotExpected"/>
                    <findLineContent dst="cie" content="CEDULA@DE@IDENTIDADE@DE@ESTRANGEIRO" threshold="0.3" overwrite="false"/>
                    <rejectIfNotValid src="cie" reason="DocumentNotExpected"/>

                    <findLineContent dst="rne" content="RNE@" threshold="1" overwrite="false"/>
                    <assignIfValid dst="docStr" src="rne" offset="+1"/>
                    <matchIfValid src="docStr" dst="docNumber"
                        regex="^([A-Za-z0-9])([A-Za-z0-9]{6}) ?- ?([A-Za-z0-9])"
                        value="([U]$1)([N]$2)-([U]$3)"
                        overwrite="false"
                    />
                    <matchIfValid src="docStr" dst="docNumber"
                        regex="^([A-Z0-9\- ]+) [A-Z]+"
                        value="($1)"
                        overwrite="false"
                    />
                    <matchIfValid src="docStr" dst="docNumber"
                        regex="^([A-Z0-9\- ]+)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="RNE"/>
                    <assignField src="docNumber" field="DocumentNumber"/>

                    <findLineContent dst="clas" content="CLASSIFICAÇÃO@" threshold="0.3" overwrite="false"/>

                    <findLineContent dst="nome" content="NOME@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="fullN" src="nome" offset="+1"/>
                    <assignField src="fullN" field="FullName"/>

                    <findLineContent dst="fil" content="FILIAÇÃO@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="motherN" src="fil" offset="+1"/>
                    <assignIfValid dst="fatherN" src="fil" offset="+2"/>
                    <assignField src="motherN" field="MotherName"/>
                    <assignField src="fatherN" field="FatherName"/>

                    <findLineContent dst="nac" content="NACIONALIDADE@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="nacionalidad" src="nac" offset="+1"/>
                    <assignField src="nacionalidad" field="Nationality"/>

                    <findLineContent dst="nat" content="NATURALIDADE@PAÍS@@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="naturalde" src="nat" offset="+1"/>
                    <assignField src="naturalde" field="Country"/>

                    <findLineContent dst="orgemi" content="ÓRGÃO@EMISSOR@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="issuingA" src="orgemi" offset="+1"/>
                    <assignField src="issuingA" field="IssuingAuthority"/>

                    <findLineContent dst="dataNasc" content="DATA@DE@NASCIMENTO@#" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="dobStr" src="dataNasc" offset="+1"/>
                    <matchIfValid src="dobStr" dst="dob" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="dob"/>
                    <assignField src="dob" field="DateOfBirth"/>

                    <findLineContent dst="dataEntrada" content="DATA@DE@ENTRADA@#" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="doentStr" src="dataEntrada" offset="+1"/>
                    <matchIfValid src="doentStr" dst="doent" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doent"/>
                    <assignField src="doent" field="DateOfEntry"/>

                    <findLineContent dst="doiStr" content="DATA@DE@EXPEDIÇĂO@#" threshold="0.3" overwrite="false"/>
                    <matchIfValid src="doiStr" dst="doi" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <!-- Some documents don't have DoI -->
                    <!-- <rejectIfNotValid src="doi"/> -->
                    <assignField src="doi" field="DateOfIssue"/>

                    <findLineContent dst="valid" content="VALIDADE@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="doeStr" src="valid" offset="+1"/>
                    <matchIfValid src="doeStr" dst="doe" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <assignIfContent dst="doe" value="31/12/9999" src="doeStr" 
                        op="distance" param="INDETERMINAD@" param_2="0.3"
                        overwrite="false"
                    />                    
                    <rejectIfNotValid src="doe"/>
                    <assignField src="doe" field="DateOfExpiry"/>


                </ML>
            </Front>
            <Back>
                <FACE/>
                <OCR>
                    <region id="FullDocument" x="0.000" y="0.000" w="1.000" h="1.000"/>
                </OCR>
                <MRZ lines="2">
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="BRA"/>
                    <field id="LastName"        line="1" starts="6" count="??"/>
                    <field id="FirstName"       line="1" starts="??" count="36"/>
                    <field id="DocumentNumber"  line="2" starts="1" count="9"/>
                    <field id="Nationality"     line="2" starts="11" count="3"/>
                    <field id="DateOfBirth"     line="2" starts="14" count="6"/>
                    <field id="Gender"          line="2" starts="21" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="22" count="6"/>

                    <field id="NfcKey"          line="2" starts="1" count="9"/>
                </MRZ>
                <!-- <BARCODE optional="yes" /> -->
                <ML cols="2" split_by="lines" separation="0.04" space_separation="0.10">

                </ML>
            </Back>
        </Version>

        <Version id="RNM" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML cols="2" split_by="lines" separation="0.04" space_separation="0.10">
                    
                    <findLineMatch src="mrzStr" dst="mrzMark" regex="(.*[&lt;«]\s?[&lt;«].*)" value="($1)"/>
                    <matchIfValid src="mrzStr" dst="mrzPresent" regex="(.{15,})" value="($1)"/>
                    <rejectIfValid src="mrzPresent" reason="DocumentNotExpected"/>

                    <findLineContent dst="rfdb" content="REPÚBLICA@FEDERATIVA@DO@BRASIL" threshold="0.3" overwrite="false"/>
                    <rejectIfNotValid src="rfdb" reason="DocumentNotExpected"/>
                    <findLineContent dst="mrk2" content="CARTEIRA@DE@REGISTRO@NACIONAL@MIGRATORIO" threshold="0.3" overwrite="false"/>
                    <findLineContent dst="mrk2" content="DOCUMENTO@PROVISORIO@DE@REGISTRO@NACIONAL@MIGRATORIO" threshold="0.3" overwrite="false"/>
                    <rejectIfNotValid src="mrk2" reason="DocumentNotExpected"/>

                    <findLineContent dst="rnm" content="RNM@" threshold="1" overwrite="false"/>
                    <assignIfValid dst="docStr" src="rnm" offset="+1"/>
                    <matchIfValid src="docStr" dst="docNumber"
                        regex="^([A-Za-z0-9])([A-Za-z0-9]{6}) ?- ?([A-Za-z0-9])"
                        value="([U]$1)([N]$2)-($3)"
                        overwrite="false"
                    />
                    <matchIfValid src="docStr" dst="docNumber"
                        regex="^([A-Z0-9\- ]+) [A-Z]+"
                        value="($1)"
                        overwrite="false"
                    />
                    <matchIfValid src="docStr" dst="docNumber"
                        regex="^([A-Z0-9\- ]+)$"
                        value="($1)"
                        overwrite="false"
                    />
                    <rejectIfNotValid src="docNumber" reason="DocumentNotExpected"/>
                    <assignField src="docNumber" field="RNM"/>

                    <findLineContent dst="sobrenome" content="SOBRENOME@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="ln" src="sobrenome" offset="+1"/>

                    <findLineContent dst="nome" content="NOME@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="fn" src="nome" offset="+1"/>
                    
                    <rejectIfNotValid src="fn"/> 
                    <rejectIfNotValid src="ln"/> 
                    <assignField src="fn" field="FirstName"/>
                    <assignField src="ln" field="LastName"/>

                    <findLineContent dst="dataNasc" content="DATA@DE@NASCIMENTO@#" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="dobStr" src="dataNasc" offset="+1"/>
                    <matchIfValid src="dobStr" dst="dob" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="dob"/>
                    <assignField src="dob" field="DateOfBirth"/>

                    <findLineContent dst="fil" content="FILIAÇÃO@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="parent1N" src="fil" offset="+1"/>
                    <assignIfValid dst="parent2N" src="fil" offset="+2"/>
                    <assignField src="parent1N" field="Parent1Name"/>
                    <assignField src="parent2N" field="Parent2Name"/>

                    <findLineContent dst="nac" content="NACIONALIDADE@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="nacionalidad" src="nac" offset="+1"/>
                    <assignField src="nacionalidad" field="NationalityCountry"/>

                    <findLineContent dst="valid" content="VALIDADE@" threshold="0.3" overwrite="false"/>
                    <assignIfValid dst="doeStr" src="valid" offset="+1"/>
                    <matchIfValid src="doeStr" dst="doe" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <matchIfValid src="doeStr" dst="doe" overwrite="false"
                        regex="8([0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="0($1)/($2)/($3)"
                    />
                    <assignIfContent dst="doe" value="31/12/9999" src="doeStr" 
                        op="distance" param="INDETERMINAD@" param_2="0.3"
                        overwrite="false"
                    />
                    <!-- DO NOT Reject because there are some documents with bad date format -->
                    <!-- <rejectIfNotValid src="doe"/> -->
                    <assignField src="doe" field="DateOfExpiry"/>

                </ML>
            </Front>
            <Back>
                <MRZ>
                    <field id="DocumentCode"    line="1" starts="1" count="2"/>
                    <field id="Issuer"          line="1" starts="3" count="3" regex="BRA"/>
                    <field id="RNM"             line="1" starts="6" count="9"/>
                    <field id="Opt1"            line="1" starts="16" count="15"/>
                    <field id="DateOfBirth"     line="2" starts="1" count="6"/>
                    <field id="Gender"          line="2" starts="8" count="1"/>
                    <field id="DateOfExpiry"    line="2" starts="9" count="6"/>
                    <field id="Nationality"     line="2" starts="16" count="3"/>
                    <field id="Opt2"            line="2" starts="19" count="11"/>
                    <field id="LastName"        line="3" starts="1" count="??"/>
                    <field id="FirstName"       line="3" starts="??" count="30"/>

                    <field id="NfcKey"          line="1" starts="6" count="9"/>
                </MRZ>
                <!-- <BARCODE optional="yes" /> -->
                <ML cols="2" split_by="lines" separation="0.04" space_separation="0.10">

                    <findLineMatch dst="mrzCleaner" regex="(.*\&lt;\s?\&lt;.*)" value="($1)"/>
                    <findLineMatch dst="mrzCleaner" regex="(.*\&lt;\s?\&lt;.*)" value="($1)"/>
                    <findLineMatch dst="mrzCleaner" regex="(.*\&lt;\s?\&lt;.*)" value="($1)"/>

                    <!-- NNN.NNN.NNN-NN -->
                    <!-- NNNNNNNNN-NN -->
                    <findLineMatch src="cpfLine" dst="cpf" overwrite="false"
                        regex="([0-9oOl]{3})[\.,:]?([0-9oOl]{3})[\.,:]?([0-9oOl]{3})-([0-9oOl]{2})"
                        value="([N]$1).([N]$2).([N]$3)-([N]$4)"
                        mode="reverse"
                    />
                    <findLineContent dst="cpfLine" content="CPF#" threshold="0" overwrite="false"/>
                    <replaceIfValid dst="cpfLine" content=" " replace=""/>
                    <matchIfValid src="cpfLine" dst="cpf" overwrite="false"
                        regex="([0-9oOl]{9})[\/7]([0-9oOl]{2})"
                        value="([N]$1)/([N]$2)"
                    />
                    <matchIfValid src="cpfLine" dst="cpf" overwrite="false"
                        regex="([0-9oOl] ?[0-9oOl] ?[0-9oOl] ?[0-9oOl] ?[0-9oOl] ?[0-9oOl] ?[0-9oOl] ?[0-9oOl] ?[0-9oOl] ?)[\/7 ]([0-9oOl]{2})"
                        value="([N]$1)/([N]$2)"
                    />
                    <matchIfValid src="cpfLine" dst="cpf" overwrite="false"
                        regex="([0-9oOl]{3})[\.,:]?([0-9oOl]{3})[\.,:]?([0-9oOl]{3})-([0-9oOl]{2})"
                        value="([N]$1).([N]$2).([N]$3)-([N]$4)"
                    />
                    <rejectIfNotValid src="cpf" reason="DocumentNotExpected"/>
                    <assignField src="cpf" field="CPF"/>
                    <assignField src="cpf" field="DocumentNumber"/>

                    <findLineContent dst="clas" content="CLASSIFICAÇÃO@#" threshold="0.3" overwrite="false"/>

                    <findLineContent dst="pdr_ind" content="PRAZO@DE@RESIDÊNCIA@@Indeterminado" threshold="0.3" overwrite="false"/>
                    <assignIfContent dst="dore" value="31/12/9999" src="pdr_ind" op="exists"/>

                    <findLineContent dst="pdr" content="PRAZO@DE@RESIDÊNCIA#" threshold="0.3" overwrite="false"/>
                    <matchIfValid src="pdr" dst="dore" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        value="($1)/($2)/($3)"
                    />
                    <!-- <rejectIfNotValid src="dore"/> -->
                    <assignField src="dore" field="DateOfResidenceExpiry"/>                    

                    <findLineContent dst="emis" content="EMISSÃO#" threshold="0.3" overwrite="false"/>
                    <matchIfValidMultiple src="emis" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3}) (.+)"
                        dst1="doi"
                        value1="($1)/($2)/($3)"
                        dst2="issuingA"
                        value2="($4)"
                    />
                    <matchIfValidMultiple src="emis" overwrite="false"
                        regex="([0-3][0-9])(?: |[^A-Za-z0-9])*([0-1][0-9])(?: |[^A-Za-z0-9])*([1-2][0-9]{3})"
                        dst1="doi"
                        value1="($1)/($2)/($3)"
                    />
                    <rejectIfNotValid src="doi"/>
                    <assignField src="doi" field="DateOfIssue"/>                    

                    <assignIfValid dst="issuingAStr" src="emis" offset="1"/>
                    <matchIfValid src="issuingAStr" dst="issuingA" overwrite="false"
                        regex="([A-Z]+)/([A-Z]+)/([A-Z]+)"
                        value="($1)/($2)/($3)"
                    />                    
                    <assignField src="issuingA" field="IssuingAuthority"/>                    

                </ML>
            </Back>
        </Version>        
    </DocumentID>

<!--
    <DocumentID id="JP" iso="JPN">
        <Version id="FC" type="TD1" document_type="FOC">
            <Front>
                <FACE/>
                <ML-JP cols="5" split_by="elements" separation="0.05" space_separation="0.1">
                </ML-JP>
            </Front>
        </Version>
    </DocumentID>
-->        

    <Supported
        Front="BE,HR,CY,CZ,DK,EE,FI,FR,DE,GR,HU,IT,LV,LU,MT,NL,NO,PL,PT,SK,SI,ES,SE,CH,GB,KW,OM,QA,SA,TR,AE,AR,CL,CO,MX,PA,BN,MY,SG,TW,CA,US,TH,UK"
        Back= "BE,HR,CY,CZ,DK,EE,FI,FR,DE,GR,HU,IT,LV,LU,MT,NL,NO,PL,PT,SK,SI,ES,SE,CH,GB,KW,OM,QA,AE,AR,CL,CO,MX,PA,BN,SG,CA,US"

        Exceptions-Front=""
        Exceptions-Back=""
    />

</selphid-widget-conf>
